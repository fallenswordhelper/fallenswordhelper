import{a as pe}from"./chunk-VBGB2XLW.js";import{a as fe}from"./chunk-YXABNXQA.js";import{a as le}from"./chunk-YIPBMOIC.js";import{a as x}from"./chunk-ZOOWVF4R.js";import{a as ce}from"./chunk-ICAAGKSH.js";import{a as me}from"./chunk-QRB25M5V.js";import{a as ie}from"./chunk-AOOPN6WB.js";import{a as J}from"./chunk-HNWBHHXU.js";import{a as X}from"./chunk-BTCLYERS.js";import{a as oe,b as S}from"./chunk-4WWEO4K3.js";import{a as m}from"./chunk-KLU3NYXX.js";import{a as ee}from"./chunk-LARETTHC.js";import{b as d}from"./chunk-MJHY5FVK.js";import{a as ne}from"./chunk-KFUQAFNA.js";import{a as O}from"./chunk-F4FR4PPZ.js";import{a as F}from"./chunk-EHLYPUDG.js";import{a as Z}from"./chunk-VLL6MMT3.js";import{a as s}from"./chunk-OZZ26S4K.js";import{a as T}from"./chunk-2BFYZNUH.js";import{a as k}from"./chunk-3P332KR6.js";import{a as se}from"./chunk-AQKFNZOY.js";import{a as re}from"./chunk-6R6RPTTO.js";import{a as te}from"./chunk-UU6HXUOC.js";import{a as w}from"./chunk-BM4FUEFL.js";import{a as K}from"./chunk-JW2UKJSK.js";import{a as f}from"./chunk-MDOXDTXF.js";import{a as ae}from"./chunk-FLC7HS56.js";import{a as Q}from"./chunk-OOUI3CKV.js";import{a as j}from"./chunk-SHVFOAM5.js";import{a as W}from"./chunk-N56IAE2U.js";import{a as n}from"./chunk-O5NIYLDT.js";import{a as l}from"./chunk-FE4PDZXL.js";import{b}from"./chunk-VMJ6DXBZ.js";import{Ia as Y,Ja as z,Ka as h,R as U,ra as L,t as N}from"./chunk-4P4O4YGO.js";import{a as c}from"./chunk-RH5336H4.js";var v;async function we(){return f(await fe(!1)).filter(([,e])=>W(e)).map(([e])=>e)}async function y(e){return ee()&&!v&&(v=we()),(await v).includes(e)}var xe=e=>[e,O(e.href,"target_username")],Ae=async([e,t])=>[e,t,await y(t)],Le=e=>e?' class="pmAttackUrl"':"";function Se(e,[t,r]){ce(t,` | <a${Le(e)} href="${U}${r}">Attack</a>`)}async function C(e,t){let r=n('a[href*="=createsecure&"]',e);if(!r.length)return;let o=r.map(xe);(await Promise.all(o.map(Ae))).filter(([,,i])=>!i).forEach(i=>Se(t,i))}var ke=e=>e?' class="pmIgnoreUrl"':"",ve=(e,t)=>`<a${ke(e)} href="${N}${s(t)}" data-tooltip="Add to Ignore List">Ignore</a>`;function Ce(e,[t,r]){T(r.cells[1],`<font size="1"><br>[ ${ve(e,t)} ]</font>`)}function P(e,t){let r=n(h,e);if(r.length===0)return;r.map(a=>[a,m(a)]).forEach(a=>Ce(t,a))}function E(e){return ae({cmd:"combat",subcmd:"view",combat_id:e})}function _(e){return te({cmd:"combat",subcmd:"view",combat_id:e})}function ue(e){return Number(e.getAttribute("background").match(/\/(\d+)/)?.[1])}function p(e,t){let r=new RegExp(`${t} = (\\d+)`);return Number(e.match(r)[1])}var Pe=[[18,/(\w+)+ leeched the buff '([A-Za-z ]+)'./],[21,/(\w+)+ was mesmerized by Spell Breaker, losing the '([A-Za-z ]+)' buff./]];function Ee(e){let t=Pe.map(([r,o])=>[r,e.match(o)]).find(([,r])=>r);return t?{id:t[0],params:[t[1][1],t[1][2]]}:(Q("Logs","Missing PvP Special",e),{id:-1,params:["-1","-1"]})}function _e(e){return n("#specialsDiv",e).map(s).filter(t=>["leeched","Spell"].some(r=>t.includes(r))).map(Ee)}function $e(e){return{id:ue(e.rows[1].cells[0]),name:s(e.rows[0].cells[0])}}function Re(e){return{id:ue(e.rows[1].cells[2]),name:s(e.rows[0].cells[2])}}function Ge(e,t){let r=t.children[0].rows[5].cells[0].children[0];return{attacker:$e(r),defender:Re(r),id:Number(e),specials:_e(t)}}function qe(e){let t=l(e.children[1]);return{gold_gain:p(t,"goldGain"),gold_stolen:p(t,"goldStolen"),pvp_prestige_gain:p(t,"prestigeGain"),pvp_rating_change:p(t,"pvpRatingChange"),winner:p(t,"winner"),xp_gain:p(t,"xpGain")}}function Me(e,t){return{...Ge(e,t),...qe(t)}}function Be(e,t){let r=re(t),o=j("pCC",r);return{r:Me(e,o),s:!0}}function $(e){return _(e).then(c(Be,e))}function R(e){return se(E,$,e)}var G="fsh_pvpCombat",q,A;function Ie(e,[t,r]){return t==="lastCheck"||r.logTime&&r.logTime>e}function De(e){let t=d-7*24*60*60,o=f(e).filter(c(Ie,t)),a={...ie(o),lastCheck:d};return S(G,a),a}async function Ve(){let e=await oe(G);if(!e)return{lastCheck:d};let t=d-24*60*60;return!e.lastCheck||e.lastCheck<t?De(e):e}async function He(e,t,r){let o=await R(t);if(!(!o||!o.s))return A||(A={...r}),A[t]={...o,logTime:x(s(e.cells[1]))/1e3},S(G,A),o}async function M(e,t){q||(q=Ve());let r=await q;return r[t]&&r[t].logTime?r[t]:He(e,t,r)}var de="fshGreen",ye="fshRed",je=e=>F(Y,e),Ne=([,e])=>!/\(Guild Conflict\)/.test(e),Ue=async([e,t])=>[e,t,await M(e,/combat_id=(\d+)/.exec(t)[1])];function Ye(e,t){return/You were victorious over/.test(t)?[de,`You were <span class="${de}">victorious</span> over `]:/You were defeated by/.test(t)?[ye,`You were <span class="${ye}">defeated</span> by `]:["",l(e.cells[2].firstChild)]}function g(e,t,r){return e!==0?`${t}:<span class="${r}">${X(e)}</span> `:""}function ze(e,t){return t.id===18?`${e}<br><span class="fshRed fshBold">${t.params[0]} leeched the buff '${t.params[1]}'.</span>`:t.id===21?`${e}<br><span class="fshRed fshBold">${t.params[0]} was mesmerized by Spell Breaker, losing the '${t.params[1]}' buff.</span>`:e}function Oe(e,t){return g(e.r.xp_gain,"XP stolen",t)+g(e.r.gold_gain,"Gold lost",t)+g(e.r.gold_stolen,"Gold stolen",t)+g(e.r.pvp_prestige_gain,"Prestige gain",t)+g(e.r.pvp_rating_change,"PvP change",t)+e.r.specials.reduce(ze,"")}function We([e,t,r]){let[o,a]=Ye(e,t),i=Oe(r,o);e.cells[2].firstChild.remove(),me(e.cells[2],a),w(e.cells[2],K({innerHTML:i}))}function Ke(e){return e.map(m).filter(je).map(t=>[t,t.cells[2].innerHTML]).filter(Ne).map(Ue)}var Qe=([,,e])=>e&&e.s;async function B(e){let t=n('a[href*="&combat_id="]',e);if(t.length===0)return;(await Promise.all(Ke(t))).filter(Qe).forEach(We)}function I(e){n('a[href*="=trade&"]',e).forEach(t=>k("Trade",t)),n('a[href*="=createsecure&"]',e).forEach(t=>k("ST",t))}var ge=e=>e.username,u;async function he(){let e=await le(!1);return{_allies:e._allies.map(ge),_enemies:e._enemies.map(ge)}}async function be(e){return u||(u=he()),(await u)._allies.includes(e)}async function Te(e){return u||(u=he()),(await u)._enemies.includes(e)}function Ze(e,t){let r=e.rows[0].cells[2];r&&!t&&T(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Xe(e){let t="",r=s(e),[o,a,i]=await Promise.all([y(r),be(r),Te(r)]);return o?t="guild":a?t="ally":i&&(t="enemy"),[`.fshPlayerColoring tr:nth-of-type(${m(e).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,t]}function Fe(e,[t,r]){return e[r]?e[r].push(t):e[r]=[t],e}var Je={guild:"green",ally:"blue",enemy:"red"};function et([e,t]){return`${t.join(", ")} { color: ${Je[e]}; }`}var tt=([,e])=>e;function rt(e){return f(e.filter(tt).reduce(Fe,{})).map(et)}function ot(e,t,r){let o=rt(t);o.length&&(Ze(e,r),e.classList.add("fshPlayerColoring"),w(document.body,J(o.join(`
`))))}async function D(e,t){let r=n(h,e);if(!r.length)return;let o=await Promise.all(r.map(Xe));ot(e,o,t)}var V,nt=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function at(e){return nt.test(l(e.cells[2]))}function st(e){let t=x(s(e.cells[1]));t>V&&(Z(L,t),V=t)}function H(e){V=b(L),n(z,e).map(m).filter(at).forEach(st)}var mt=[["addIgnoreLink",P],["colorPlayerNames",D],["addAttackLinkToLog",C],["changeButtonLabels",I],["trackLadderReset",H],["showPvPSummaryInLog",B]];function it(e,t,r){b(r[0])&&r[1](e,t)}function ct(e,t){mt.forEach(c(it,e,t))}function lt(e){if(ne())return;let t=pe();t&&ct(t,e)}export{lt as a};
//# sourceMappingURL=chunk-G34QC2L2.js.map
