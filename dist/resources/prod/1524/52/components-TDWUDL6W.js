import{a as d}from"./chunk-ATFXUHX5.js";import"./chunk-NYSXQY3D.js";import{a as rt}from"./chunk-NMCSNKGX.js";import{a as nt}from"./chunk-2WVMNN2D.js";import{a as tt}from"./chunk-3AH4RSRQ.js";import"./chunk-5ECO4FLG.js";import"./chunk-MLOBOIWO.js";import{a as mt}from"./chunk-5HUM7WCX.js";import{p as at}from"./chunk-75EO2HKA.js";import"./chunk-L3EJTUOG.js";import{a as ot}from"./chunk-3E4MLHMF.js";import{a as et}from"./chunk-6OLNGI5Q.js";import{a as O}from"./chunk-RUMWLVS5.js";import{a as z}from"./chunk-2MLCOS3N.js";import{a as M}from"./chunk-WAW4DHQF.js";import{a as W}from"./chunk-5VQHDDXC.js";import{a as v}from"./chunk-7UPJBGX2.js";import{a as X}from"./chunk-NGWVGVXB.js";import{a as J}from"./chunk-G5RZKOR2.js";import{a as G}from"./chunk-GSZMCZFV.js";import{a as P}from"./chunk-LBVFY7UY.js";import{a as b}from"./chunk-77BSQLWR.js";import{a as p}from"./chunk-BLRY34YR.js";import"./chunk-CIFA6X4K.js";import"./chunk-PSQKPSME.js";import{a as l}from"./chunk-3J2YA6B7.js";import{a as Z}from"./chunk-SDA4FQMK.js";import"./chunk-T6BAO7XX.js";import{a as B}from"./chunk-KCQPJD5H.js";import{a as g}from"./chunk-ML7SUXNI.js";import{a as k}from"./chunk-XY4KZRCS.js";import{a as E}from"./chunk-5IIHJLHJ.js";import"./chunk-5M4Z4TNO.js";import"./chunk-C3UZY667.js";import{a as m}from"./chunk-UAOZMKLO.js";import{a as D}from"./chunk-OLMGIENV.js";import"./chunk-TICG7NTW.js";import"./chunk-7VZZ35FX.js";import"./chunk-EWDLMFWA.js";import{a as Y}from"./chunk-6BZLLWOX.js";import{a as N}from"./chunk-M2ZMFQNM.js";import"./chunk-H7LEI34Q.js";import"./chunk-MZ7GLTZN.js";import"./chunk-GEUXEI3G.js";import{a as K}from"./chunk-NR4PY7IS.js";import"./chunk-WKK2D5SI.js";import"./chunk-CVQ7E5PW.js";import{a}from"./chunk-KN5ZC5BT.js";import{a as F}from"./chunk-DUQP22PP.js";import"./chunk-NDCVQHVH.js";import{a as s}from"./chunk-3Q2VMWIC.js";import"./chunk-ZOSMVBRJ.js";import{a as V}from"./chunk-ZJNDZYVS.js";import"./chunk-OUMBZBCQ.js";import{a as x}from"./chunk-RL27SC3C.js";import"./chunk-KCBAQFJY.js";import"./chunk-DM72I4Z3.js";import{a as T}from"./chunk-Y2LZWOTV.js";import"./chunk-I7LLJIV6.js";import"./chunk-6SHDCONG.js";import"./chunk-BWOLSDKS.js";import{g as h}from"./chunk-RLOFFV7B.js";import{b as C}from"./chunk-XYKKLBWK.js";import{a as r}from"./chunk-BOMGPUDJ.js";var ct=/\?item_id=(\d+)&inv_id=(\d+)&.*&vcode=([0-9a-f]+)/;function pt(t){let o=t.children[0].dataset.tipped.match(ct);return{a:Number(o[2]),b:Number(o[1]),v:o[3]}}var st=t=>x('a[href*="=destroycomponent&"]',t).map(pt),lt=t=>x('td[background*="1x1mini"]',t).length;function dt(t){let o=t.map(k),e=o.map(st),n=[].concat(...e);return{h:{cm:o.map(lt).reduce(z,0)},r:n}}function ft(t){let o=k(t),n=x('a[href*="profile&component_page="]',o).map(c=>K(c.href));return d(n,dt)}function I(){return E({cmd:"profile"}).then(ft)}function H(){return N({subcmd:"loadcomponents"})}function $(){return B(H,I)}var f;function ut(t,o){return t[o.b]=t[o.b]||{a:o.a,b:o.b,count:0,del:[],v:o.v},t[o.b].count+=1,t[o.b].del.push(o.a),t}function it(t){f=t.r.reduce(ut,{})}function yt(t,o){return`${t}<tr><td><img src="${C}items/${o.b}.gif" class="fshTblCenter tip-dynamic" data-tipped="fetchitem.php?item_id=${o.b}&inv_id=${o.a}&t=2&p=${et()}&vcode=${o.v}"></td><td>${o.count}</td><td>[<span class="sendLink compDelType" data-compid="${o.b}">Del</span>]</td></tr>`}function Ct(t){let o=M();return it(t),p(o,`<tr><td colspan="3">Component Summary</td></tr>${Object.values(f).reduce(yt,"")}`),o}function ht(t){let o=t.insertRow(-1);p(o,"<td>Total:</td>");let e=o.insertCell(-1);return e.colSpan=2,e}function gt(t){let o=t.r.length,e=v();return a(o,e),e}function bt(t,o){let e=ht(t);m(e,gt(o)),O(e," / TODO")}function Tt(t){let o=W({className:"fshTblCenter",id:"fshTally"});return m(o,Ct(t)),bt(o,t),o}function xt(t,o){if(!g(o.r))return;let e=t.parentNode;e&&(a("",e),m(e,Tt(o)))}function S(t){s("components","countComponent"),$().then(r(xt,t))}function A(t){let o=D(),e=v({className:`sendLink ${P(t).replace(/ /g,"-")}`,textContent:t});return l("[",o),m(o,e),p(o,"]"),o}function L(t){return N({subcmd:"destroycomponent",removeIndex:t})}function Dt(t,o){let e=Z(o),n=1;return e==="Component destroyed."&&(n=0),{r:n,m:e,c:t}}function Et(t){return E({cmd:"profile",subcmd:"destroycomponent",component_id:t}).then(r(Dt,t))}function vt(t){let o=t.filter(n=>n.r===0),e=t.filter(n=>n.r===1);return o.length>0?{r:o.map(n=>n.c),s:!0}:e.length>0?{e:{message:e[0].m},s:!1}:{e:{message:t[0].m},s:!1}}function j(t){return d(t.map(Et),vt)}function u(t){return B(L,j,t)}var R;function i(){if(!R){let t=J("inventory-table",V("profileRightColumn"));t.length===2&&([,R]=t)}return R}var q;function Nt(t,o){let e=o.dataset.tipped.match(h);return t[e[2]]=o.parentNode.parentNode,t}function Bt(){return q||(q=b("img",i()).reduce(Nt,{})),q}function At(t,o){t[o]&&a("",t[o])}function w(t){t.forEach(r(At,Bt()))}function y(t){let o=i().parentNode;if(!o)return;let e=o.children[2].children[1].children[0];if(!e||e.tagName!=="TABLE")return;let n=e.rows,c=n[n.length-1].cells[1].children[0],U=Number(T(c));U-=t,l(U,c)}function kt(t){a("",t),t.className="guildTagSpinner",t.style.backgroundImage=`url('${C}ui/misc/spinner.gif')`}function It(t){t.s&&g(t.r)&&(w(t.r),y(t.r.length))}function Ht(t){t.parentNode.remove()}function $t(t){return u(t).then(It)}function _(t){let o=f[t.dataset.compid].del,e=t.parentNode;kt(e);let n=nt(30,o).map($t);d(n,r(Ht,e))}function St(t){let o=G(`#fshTally [data-compid="${t}"]`);if(!o)return;let e=o.parentNode.parentNode.children[1],n=Number(T(e))-1;l(n,e)}function Lt(t,o,e){e.s&&(St(o),y(1),t.parentNode&&a("",t.parentNode))}function Q(t){let{tipped:o}=t.parentNode.children[0].children[0].dataset,e=o.match(h),n=e[1],c=e[2];u([c]).then(Y).then(r(Lt,t,n))}var jt=["Enable Quick Del","Count Components","Quick Extract Components"];function Rt(t,o){return m(t,A(o)),t}function qt(){return jt.reduce(Rt,D({className:"fshCenter"}))}function wt(){s("components","insertQuickExtract"),mt(at)}function _t(t){p(t.parentNode.parentNode,'<span class="compDelBtn">Del</span>')}function Qt(t){s("components","enableDelComponent");let o=t.parentNode;X(o);let e=o.parentNode;m(e,A("Delete All Visible")),b("img",i()).forEach(_t)}function Ut(t){s("components","delAllComponent");let o=t.parentNode.parentNode.parentNode.children[0];rt("compDelBtn",o).forEach(ot)}var Vt=[["quick-extract-components",wt],["enable-quick-del",Qt],["delete-all-visible",Ut],["compDelBtn",Q],["count-components",S],["compDelType",_]];function Pt(t){let o=t.parentNode;m(o,qt()),F(o,tt(Vt))}function Ot(){let t=i();!t||Pt(t)}export{Ot as default};
//# sourceMappingURL=components-TDWUDL6W.js.map
