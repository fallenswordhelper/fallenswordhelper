import{a as ft}from"./chunk-KQIGQKIJ.js";import{a as w}from"./chunk-TVPC7N2U.js";import{a as ct,b as lt}from"./chunk-KE7QVZCM.js";import{a as mt}from"./chunk-EE4KVOI4.js";import{a as st}from"./chunk-YDFJNTS6.js";import{a as m}from"./chunk-YPLJMAPK.js";import{a as at}from"./chunk-2QQEESV4.js";import{a as it}from"./chunk-RUXMRPWO.js";import{a as nt}from"./chunk-5OE6VIM4.js";import{a as g}from"./chunk-3HZ2ZPQ6.js";import{a as p}from"./chunk-BHUPUMLW.js";import{a as C}from"./chunk-3HOKC23F.js";import{a as K}from"./chunk-SRIPYTEL.js";import{a as b}from"./chunk-EAGLSPMW.js";import{a}from"./chunk-U2TRZZ3E.js";import{a as Y}from"./chunk-XR7PDYD5.js";import{a as W}from"./chunk-BXBVOC5K.js";import{a as et}from"./chunk-5S2Z7IMU.js";import{a as J}from"./chunk-QML5ST72.js";import{a as f}from"./chunk-6RGWX5PS.js";import{a as h}from"./chunk-5Q7RHZGG.js";import{a as X}from"./chunk-HJS3N6S5.js";import{a as Q,b as L}from"./chunk-W4JHNOGK.js";import{a as O}from"./chunk-RUYWS2HZ.js";import{a as ot}from"./chunk-GVKNJUVY.js";import{a as rt}from"./chunk-PGTVN5WS.js";import{a as z}from"./chunk-MW3ALH4C.js";import{a as n}from"./chunk-JXYF35XK.js";import{d as P,f as Z,g as tt}from"./chunk-LRKZIFKI.js";import{a as y}from"./chunk-RM2JYA44.js";import{a as T}from"./chunk-7Q474OAN.js";import{b as d}from"./chunk-HSRR66FY.js";import{La as U,Ma as F,Na as u,U as N,ua as k,w as j}from"./chunk-HQDTBPDS.js";var gt=t=>[t,g(t.href,"target_username")],yt=async([t,e])=>[t,e,await ct(e)],ht=t=>t?' class="pmAttackUrl"':"";function bt(t,[e,r]){at(e,` | <a${ht(t)} href="${N}${r}">Attack</a>`)}async function S(t,e){let r=n('a[href*="=createsecure&"]',t);if(!r.length)return;let o=r.map(gt);(await Promise.all(o.map(yt))).filter(([,,s])=>!s).forEach(s=>bt(e,s))}var wt=t=>t?' class="pmIgnoreUrl"':"",vt=(t,e)=>`<a${wt(t)} href="${j}${a(e)}" data-tooltip="Add to Ignore List">Ignore</a>`;function Tt(t,[e,r]){p(r.cells[1],`<font size="1"><br>[ ${vt(t,e)} ]</font>`)}function x(t,e){let r=n(u,t);if(r.length===0)return;r.map(i=>[i,m(i)]).forEach(i=>Tt(e,i))}function A(t){return rt({cmd:"combat",subcmd:"view",combat_id:t})}function $(t){return J({cmd:"combat",subcmd:"view",combat_id:t})}var kt=t=>Number(T(/\/(?<id>\d+)/,t.getAttribute("background")));function c(t,e){let r=new RegExp(`${e} = (\\d+)`);return Number(T(r,t))}function Ct(t){let e=[[18,"leeched"],[21,"Spell"]].map(([r,o])=>[r,t.includes(o),t.split(" ")[0],t.split("'")[1]]).find(([,r])=>r);return e?{id:e[0],params:[e[2],e[3]]}:(z("Logs","Missing PvP Special",t),{id:-1,params:["-1","-1"]})}function Lt(t){return n("#specialsDiv",t).map(a).filter(i=>["leeched","Spell"].some(s=>i.includes(s))).map(Ct)}function pt(t,e){return{id:kt(t.rows[1].cells[e]),name:a(t.rows[0].cells[e])}}function Pt(t,e){let r=e.children[0].rows[5].cells[0].children[0];return{attacker:pt(r,0),defender:pt(r,2),id:Number(t),specials:Lt(e)}}function St(t){let e=f(t.children[1]);return{gold_gain:c(e,"goldGain"),gold_stolen:c(e,"goldStolen"),pvp_prestige_gain:c(e,"prestigeGain"),pvp_rating_change:c(e,"pvpRatingChange"),winner:c(e,"winner"),xp_gain:c(e,"xpGain")}}function xt(t,e){return{...Pt(t,e),...St(e)}}function At(t,e){let r=et(e),o=Y("pCC",r);return{r:{combat:xt(t,o)},s:!0}}async function _(t){let e=await $(t);return At(t,e)}function R(t){return nt(A,_,t)}var I="fsh_pvpCombat",E=null,v=0;function $t(t,[e,r]){return e==="lastCheck"||r.logTime&&r.logTime>t}function _t(t){let r=h(t).filter(y($t,tt())),o={...it(r),lastCheck:P()};return L(I,o),o}async function Rt(){let t=await Q(I);return t?!t.lastCheck||t.lastCheck<Z()?_t(t):t:{lastCheck:P()}}async function Et(t,e,r){let o=await R(e);if(!(!o||!o.s))return v||(v={...r}),v[e]={...o,logTime:w(a(t.cells[1]))/1e3},L(I,v),o}async function G(t,e){E||(E=Rt());let r=await E;return r[e]&&r[e].logTime?r[e]:Et(t,e,r)}var ut="fshGreen",dt="fshRed",It=([,t])=>W(U,t),Gt=t=>t.href.split("=").at(-1),Bt=async([t,e,r])=>[e,r,await G(e,Gt(t))],Dt=([,,t])=>t&&t.s,qt=t=>[18,21,31].includes(t.id),B=t=>`<span class="fshRed fshBold">${t}.</span>`;function Ht(t){return t.includes("You were victorious over")?[ut,`You were <span class="${ut}">victorious</span> over `]:t.includes("You were defeated by")?[dt,`You were <span class="${dt}">defeated</span> by `]:["",null]}function Mt(t){return t.id===18?B(`${t.params[0]} leeched the buff '${t.params[1]}'`):t.id===21?B(`${t.params[0]} was mesmerized by Spell Breaker, losing the '${t.params[1]}' buff`):B(`${t.params[0]} activated Fist Fight`)}function l(t,e,r){return t!==0?`${e}:<span class="${r}">${ot(t)}</span> `:""}function Vt(t,e){let r=t.specials.filter(qt).map(Mt),o=l(t.xp_gain,"XP stolen",e)+l(t.gold_gain,"Gold lost",e)+l(t.gold_stolen,"Gold stolen",e)+l(t.pvp_prestige_gain,"Prestige gain",e)+l(t.pvp_rating_change,"PvP change",e);return o+(o&&r.length?"<br>":"")+(r.length?`${r.join("<br>")}`:"")}function Yt([t,e,r]){let[o,i]=Ht(e);i&&(t.cells[2].firstChild.remove(),mt(t.cells[2],i));let s=Vt(r.r.combat,o);s&&b(t.cells[2],K({innerHTML:s}))}function jt(t){return t.map(e=>[e,m(e)]).filter(It).map(([e,r])=>[e,r,r.cells[2].innerHTML]).map(Bt)}async function D(t){let e=n('a[href*="&combat_id="]',t);if(e.length===0)return;(await Promise.all(jt(e))).filter(Dt).forEach(Yt)}function q(t){n('a[href*="=trade&"]',t).filter(e=>!g(e.href,"subcmd")).forEach(e=>C("Trade",e)),n('a[href*="=createsecure&"]',t).forEach(e=>C("ST",e))}function Nt(t,e){let[,,r]=t.rows[0].cells;r&&!e&&p(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Ut(t){let[,e]=await lt(t);return[`.fshPlayerColoring tr:nth-of-type(${m(t).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,e]}function Ft(t,[e,r]){return t[r]?t[r].push(e):t[r]=[e],t}var Wt={guild:"green",ally:"blue",enemy:"red"};function zt([t,e]){return`${e.join(", ")} { color: ${Wt[t]}; }`}var Kt=([,t])=>t;function Ot(t){return h(t.filter(Kt).reduce(Ft,{})).map(zt)}function Qt(t,e,r){let o=Ot(e);o.length&&(Nt(t,r),t.classList.add("fshPlayerColoring"),b(document.body,st(o.join(`
`))))}async function H(t,e){let r=n(u,t);if(!r.length)return;let o=await Promise.all(r.map(Ut));Qt(t,o,e)}var M=0,Xt=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function Jt(t){return Xt.test(f(t.cells[2]))}function Zt(t){let e=w(a(t.cells[1]));e>M&&(X(k,e),M=e)}function V(t){M=d(k),n(F,t).map(m).filter(Jt).forEach(Zt)}var te=[["addIgnoreLink",x],["colorPlayerNames",H],["addAttackLinkToLog",S],["changeButtonLabels",q],["trackLadderReset",V],["showPvPSummaryInLog",D]];function ee(t,e,[r,o]){d(r)&&o(t,e)}function re(t,e){te.forEach(y(ee,t,e))}function oe(t){if(O())return;let e=ft();e&&re(e,t)}export{oe as a};
//# sourceMappingURL=chunk-NOZQLKSP.js.map
