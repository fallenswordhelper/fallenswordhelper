import{g as t}from"./getMembrList-c23778b8.js"
import{cj as e,i as n,bY as s,p as a,ac as i,aF as r,bJ as c,cC as d,c as o,bj as l,ae as u,cs as f,cD as p,bl as m,C as h,bE as b,F as y,$ as v,j as g,aE as k,aJ as _,s as x,v as I,S as R,K as L,L as M,M as w,N as E,O as S,Q as j,R as D,V as N,X as T,Y as A,Z as C,n as G,aw as P,w as q,bO as O,f as U,aN as F,bK as B,bL as W}from"./calfSystem-abb16b0d.js"
import{a as V}from"./all-414e0607.js"
import{e as H}from"./executeAll-ef9da8be.js"
import{l as Q}from"./loadDataTables-36dfed14.js"
import{d as Y,a as J,b as K}from"./deepClone-789c716e.js"
import{d as X}from"./daLoadInventory-c2278c3f.js"
import{b as Z}from"./basicItem-890121ae.js"
import{e as z,d as tt,m as et,a as nt}from"./dropItem-6a02803c.js"
import{f as st}from"./flattenItems-03659160.js"
import{c as at}from"./createTable-b4e2f7ef.js"
import{g as it,s as rt}from"./idb-e719862a.js"
import{i as ct}from"./isSelected-5d9f5edf.js"
import{a as dt,e as ot,u as lt}from"./useItem-1d2f7d6d.js"
import{g as ut}from"./guildInventory-285cf47e.js"
import{h as ft}from"./htmlResult-6b7c7e7e.js"
import{e as pt}from"./errorDialog-9e633a62.js"
import{q as mt,a as ht}from"./queue-cf15dedb.js"
import{c as bt}from"./changeMinMax-d4bd1aea.js"
import{p as yt,l as vt}from"./lvlTests-3097e750.js"
import{i as gt}from"./intValue-e1798d0a.js"
import{i as kt}from"./isArray-09a53da7.js"
import"./guildMembers-d914b75d.js"
import"./now-6f22aec9.js"
import"./guild-9354fe8b.js"
import"./dialog-9896baf4.js"
import"./dialogMsg-7c5fba89.js"
import"./sendItems-ad34279c.js"
import"./daUseItem-bb43bd02.js"
import"./InfoBoxFrom-2b40207c.js"
import"./backpackOk-c0c72b73.js"
import"./takeItem-08215f5b.js"
import"./numberIsNaN-a40c3bbb.js"
function _t([t]){return"lastUpdate"!==t}function $t(){return e({subcmd:"inventory"})}let xt=""
const It=()=>xt
function Rt(t){xt||(xt=t.message),xt&&n(a(),s("p",{className:"fshRed",textContent:xt}))}let Lt={}
const Mt=()=>Lt
async function wt(t){try{return await t()}catch(t){if(500!==t.jqXhr.status)throw t
Rt(t)}}const Et=(t,e)=>{return e.map(Z).map((n=t,function(t){const e=n?.find((({inv_id:e})=>e===t.inv_id))
return{...t,...e?.stats&&{stats:{...t.stats,armor:e.stats.armor,attack:e.stats.attack,damage:e.stats.damage,defense:e.stats.defense,hp:e.stats.hp,set_name:e.stats.set_name??""}}}}))
var n},St=t=>({...t,equipped:!0,folder_id:-2}),jt=(t,e,n)=>({folders:z(t),items:Et(e,n),player_id:r()})
const Dt=t=>({...t,player:{id:-1}}),Nt=(t,e)=>({current_player_id:r(),items:Et(t,e),guild_id:c()})
async function Tt(){if("invmanagernew"===i.subcmd){const t=await async function(){const[t,e]=await V([wt($t),X()]),n=t?.items??[],s=e?.r??{},a=(s.equipment?.map(St)??[]).concat(st(s))
return jt(s,n,a)}()
Lt=t}else if("guildinvmgr"===i.subcmd){const t=await async function(){const[t,e,n]=await V([wt(d),Y(),J()]),s=t?.items??[],a=e?.r??[],i=n?.r??[],r=a.concat(i.map(Dt))
return Nt(s,r)}()
Lt=t}}function At(t,e){e.val(""),$(t).DataTable().search("").draw()}function Ct(){Mt().folders&&(Mt().folders[-1]="Main")}const Gt={checkedElements:{0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},fshMinLvl:1,fshMaxLvl:9999},Pt='<table class="fshInvFilter"><tr><th colspan="14">@@reportTitle@@</th><th><span id="fshRefresh" class="fshLink">[Refresh]</span></th></tr><tr><td colspan="2" rowspan="3"><b>&nbsp;Show Items:</b></td><td class="fshRight">&nbsp;Helmet:</td><td><input id="fshHelmet" type="checkbox" item="0"/></td><td class="fshRight">&nbsp;Armor:</td><td><input id="fshArmor" type="checkbox" item="1"/></td><td class="fshRight">&nbsp;Gloves:</td><td><input id="fshGloves" type="checkbox" item="2"/></td><td class="fshRight">&nbsp;Boots:</td><td><input id="fshBoots" type="checkbox" item="3"/></td><td class="fshRight">&nbsp;Weapon:</td><td><input id="fshWeapon" type="checkbox" item="4"/></td><td></td><td class="fshRight">&nbsp;Min lvl:</td><td rowspan="2"><input id="fshMinLvl" class="fshNumberInput" type="number" value="1" min="0"><br><input id="fshMaxLvl" class="fshNumberInput" type="number" value="9999" min="0"></td></tr><tr><td class="fshRight">&nbsp;Shield:</td><td><input id="fshShield" type="checkbox" item="5"/></td><td class="fshRight">&nbsp;Ring:</td><td><input id="fshRing" type="checkbox" item="6"/></td><td class="fshRight">&nbsp;Amulet:</td><td><input id="fshAmulet" type="checkbox" item="7"/></td><td class="fshRight">&nbsp;Rune:</td><td><input id="fshRune" type="checkbox" item="8"/></td><td class="fshRight">&nbsp;Sets Only:</td><td><input id="fshSets" item="-1" type="checkbox"/></td><td></td><td class="fshRight">&nbsp;Max lvl:</td></tr><tr><td colspan="2">&nbsp;[<span id="fshAll" class="fshLink">Select All</span>]</td><td colspan="2">&nbsp;[<span id="fshNone" class="fshLink">Select None</span>]</td><td colspan="2">&nbsp;[<span id="fshDefault" class="fshLink">Defaults</span>]</td><td colspan="6"></td><td><input id="fshReset" type="button" value="Reset"/></td></tr><tr><td class="fshRight">&nbsp;Quest Item:</td><td><input id="fshQuest" item="9" type="checkbox"/></td><td class="fshRight">&nbsp;Potion:</td><td><input id="fshPotion" item="10" type="checkbox"/></td><td class="fshRight">&nbsp;Resource:</td><td><input id="fshResource" item="12" type="checkbox"/></td><td class="fshRight">&nbsp;Recipe:</td><td><input id="fshRecipe" item="13" type="checkbox"/></td><td class="fshRight">&nbsp;Container:</td><td><input id="fshContainer" item="14" type="checkbox"/></td><td class="fshRight">&nbsp;Frag Stash:</td><td><input id="fshStash" item="16" type="checkbox"/></td><td class="fshRight">&nbsp;Composed:</td><td><input id="fshComposed" item="15" type="checkbox"/></td><td></td></tr><tr><td class="fshRight">&nbsp;Common:</td><td><input id="fshCommon" item="100" type="checkbox" checked/></td><td class="fshRight">&nbsp;Rare:</td><td><input id="fshRare" item="101" type="checkbox" checked/></td><td class="fshRight">&nbsp;Unique:</td><td><input id="fshUnique" item="102" type="checkbox" checked/></td><td class="fshRight">&nbsp;Legendary:</td><td><input id="fshLegendary" item="103" type="checkbox" checked/></td><td class="fshRight">&nbsp;Super Elite:</td><td><input id="fshSuperElite" item="104" type="checkbox" checked/></td><td class="fshRight">&nbsp;Crystalline:</td><td><input id="fshCrystalline" item="105" type="checkbox" checked/></td><td class="fshRight">&nbsp;Epic:</td><td colspan="2"><input id="fshEpic" item="106" type="checkbox" checked/></td></tr></table>',qt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},Ot={Perfect:{abbr:"Perf",colour:"#00b600",index:8},Excellent:{abbr:"Exc",colour:"#f6ed00",index:7},"Very Good":{abbr:"VG",colour:"#f67a00",index:6},Good:{abbr:"Good",colour:"#f65d00",index:5},Average:{abbr:"Ave",colour:"#f64500",index:4},Poor:{abbr:"Poor",colour:"#f61d00",index:3},"Very Poor":{abbr:"VPr",colour:"#b21500",index:2},Uncrafted:{abbr:"Unc",colour:"#666666",index:1}}
let Ut={},Ft=0,Bt=0
const Wt=()=>Ut,Vt=()=>Ft,Ht=()=>Bt
function Qt(t){return Ot[t]?Ot[t].abbr:""}function Yt(t,e){const n=function(t){return t.folder_id?function(t){return t.equipped?"fshGreen":"fshNavy"}(t):function(t){return-1===t.player_id?"fshNavy":"fshMaroon"}(t)}(e)
t.classList.add(n),e.equipped&&t.classList.add("fshBold")}function Jt(t){return function(t){return t.player_id&&-1!==t.player_id}(t)||function(t){return t.folder_id&&-1!==t.guild_tag}(t)}function Kt(t){return`<span class="fshLink recallItem" invid="${t.inv_id}" playerid="${l(t.player_id,Mt().player_id)}" mode="1" action="recall">GS</span>`}function Xt(t){return`<span class="fshLink storeItem" invid="${t.inv_id}">GS</span>`}function Zt(t,e,n){return"display"===t?n(e):"GS"}function zt(t,e){const n=function(t){return-1===t.player_id?4:Jt(t)?7:1}(e),s=(a=Mt().player_id,i=e.player_id,r=Mt().guild_id,a||(-1!==i?i:r))
var a,i,r
let c=""
return function(t){return t.stats&&""!==t.stats.set_name}(e)&&(c=` (<span class="fshLink setName" set="${e.stats.set_name}">set</span>)`),`<a href="${f}${t}" class="fshInvItem tip-dynamic ${p[e.rarity].clas}" data-tipped="fetchitem.php?item_id=${e.item_id}&inv_id=${e.inv_id}&t=${n}&p=${s}">${t}</a>${c}`}const te=[[t=>t.player_id&&-1===t.player_id,(t,e)=>`takeItem" action="${e.a}`],[t=>t.player_id&&t.player_id!==Mt().current_player_id,(t,e)=>`recallItem" playerid="${t.player_id}" mode="0" action="${e.a}`],[t=>function(t){return t.folder_id&&!t.equipped}(t)||function(t){return t.player_id&&!t.equipped&&t.player_id===Mt().current_player_id}(t),(t,e)=>e.c]]
function ee(t,e){const n=te.find((([e])=>e(t)))
return n?`<span class="fshLink ${n[1](t,e)}" invid="${t.inv_id}">${e.b}</span>`:""}function ne(t){return l(t.folder_id,t.player_id)}function se(t){return i.membrList[t]?i.membrList[t].username:"???"}function ae(t,e){return t[0]-e[0]}function ie(t,e){return`<option value="${e[0]}"${ct(Number(e[0]),t)}>${e[1]}</option>`}const re=[{title:"Name",data:"item_name",render:function(t,e,n){return"display"!==e?t:zt(t,n)}},{title:"Level",data:"stats.min_level"},{title:"Where",data:ne,render:{_:function(t,e,n){return n.folder_id?function(t){return t.equipped?-2:t.folder_id}(n):-1===n.player_id?"~":se(n.player_id)},display:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":`<a class="fshMaroon" href="${m}${t.player_id}">${se(t.player_id)}</a>`}(n):n.equipped?"Worn":`<select class="fshMoveItem" data-inv="${n.inv_id}">${s=n.folder_id,a=Mt().folders,h(a).sort(ae).map(o(ie,s)).join("")}</select>`
var s,a},filter:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":se(t.player_id)}(n):n.equipped?"Worn":Mt().folders[n.folder_id]}}},{title:"Type",data:"type",render:t=>b[t]},{title:"Att",data:"stats.attack"},{title:"Def",data:"stats.defense"},{title:"Arm",data:"stats.armor"},{title:"Dam",data:"stats.damage"},{title:"HP",data:"stats.hp"},{title:"Frg",data:"forge",render:function(t,e,n){if(n.type<9)return n.forge}},{title:"Craft",data:"craft",render:{_:t=>Ot[t]?Ot[t].index:0,display:Qt,filter:Qt}},{title:"Du%",data:"durability",render:function(t,e,n){if(n.type<9&&n.max_durability>0)return Math.ceil(n.durability/n.max_durability*100)}},{title:"BP",data:ne,render:function(t,e,n){if(!n.folder_id&&n.player_id!==Mt().current_player_id)return function(t,e){return"display"!==t?"BP":-1===e.player_id?`<span class="fshLink takeItem" invid="${e.inv_id}" action="take">BP</span>`:`<span class="fshLink recallItem" invid="${e.inv_id}" playerid="${e.player_id}" mode="0" action="recall">BP</span>`}(e,n)}},{title:"GS",data:ne,render:function(t,e,n){return Jt(n)?Zt(e,n,Kt):function(t){return t.folder_id&&!t.bound}(n)?Zt(e,n,Xt):void 0}},{title:"W/U",data:"type",render:function(t,e,n){const s=[1,1,1,1,1,1,1,1,1,null,2,2,null,null,null,2][t]
return 1===s?ee(n,{a:"wear",b:"Wear",c:"wearItem"}):2===s?ee(n,{a:"use",b:"Use",c:"useItem"}):void 0}},{title:"setName",data:"stats.set_name",orderable:!1,visible:!1},{title:"Tag",data:"guild_tag",render:t=>-1===t?"No":"Yes"},{title:"Drop",data:"type",render:function(t,e,n){if(!function(t){return-1!==t.guild_tag||t.equipped}(n))return"display"!==e?"Drop":`<span class="dropItem dropLink" data-tooltip="INSTANTLY DESTROY THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Drop</span>`}},{title:"Send",data:"type",render:function(t,e,n){if(!function(t){return t.equipped||-1===t.guild_tag&&t.bound}(n))return"display"!==e?"Send":`<span class="sendItem sendLink" data-tooltip="INSTANTLY SEND THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Send</span>`}}]
function ce(){return"player_id"in Mt()}function de(){const t=function(){const t=at({className:"hover fshXSmall",id:ce()?"fshUserInv":"fshGuildInv"})
return n(a(),t),t}(),e=function(t){return $(t).DataTable({autoWidth:!1,columnDefs:[{targets:"_all",defaultContent:""},{targets:[1,4,5,6,7,8,9,10,12,13],orderSequence:["desc","asc"]}],columns:re,createdRow:Yt,data:Mt().items,deferRender:!0,lengthMenu:[[50,100,150,200,-1],[50,100,150,200,"All"]],pageLength:50,stateDuration:0,stateSave:!0})}(t)
return function(t){[[12,"current_player_id"in Mt()],[17,ce()&&Vt()],[18,ce()&&Ht()]].forEach((([e,n])=>t.column(e).visible(n)))}(e),t}async function oe(t){const e=await tt(t)
return dt(e)}function le(t){return ut({subcmd2:"dostoreitems",items:t})}async function ue(t){const e=await y({cmd:"guild",subcmd:"inventory",subcmd2:"dostoreitems",storeIndex:t})
return ft(e)}async function fe(t){const e=await function(t){return v(le,ue,t)}(t)
return pt(e),dt(e)}function pe(t){rt(`fsh_${i.subcmd}`,t)}function me(){g('table.fshInvFilter input[type="checkbox"]').forEach((t=>{t.checked=1===Wt().checkedElements[t.getAttribute("item")]})),pe(Wt())}function he(t){Wt().checkedElements=qt,me(),$(t).DataTable().draw(!1)}function be(t,e){Wt().fshMinLvl=t,Wt().fshMaxLvl=e,pe(Wt())}function ye(t){$(t).DataTable().draw(!1)}function ve(t){bt(be,o(ye,t))}function ge(t){return Number(t[0])>=100}function ke(t,e){return t[e[0]]=e[1],t}function _e(t){var e
Wt().checkedElements=(e=Wt().checkedElements,h(e).filter(ge).reduce(ke,{})),me(),$(t).DataTable().draw()}function $e(t,e){t.eq(e).empty()}function xe(t,e){if(1===e.r)return
const n=t.closest("tr")
!function(t){[2,12,13,14,15,16].forEach(o($e,t))}($("td",n)),n.css("text-decoration","line-through")}async function Ie(t,e){k(e),function(t){t.closest("tr").find(".takeItem, .recallItem, .wearItem, .dropItem, .sendItem, .storeItem").removeClass()}(e),function(t){t.empty().append(`<img src="${_}ui/misc/spinner.gif" width="11" height="11">`)}(e)
const n=await t()
n&&xe(e,n)}function Re(t){Wt().checkedElements={},g('table.fshInvFilter input[type="checkbox"][item]:checked').forEach((t=>{Wt().checkedElements[t.getAttribute("item")]=1})),pe(Wt()),$(t).DataTable().draw(!1)}function Le(t){Wt().checkedElements=Gt.checkedElements,me(),$(t).DataTable().draw(!1)}function Me(t){Wt().fshMinLvl=Gt.fshMinLvl,Wt().fshMaxLvl=Gt.fshMaxLvl,pe(Wt()),function(t){$("#fshMinLvl").val(Wt().fshMinLvl),$("#fshMaxLvl").val(Wt().fshMaxLvl),$(t).DataTable().draw(!1)}(t)}function we(t,e){$(t).DataTable().search($(e.target).attr("set")).draw(),$(`#${t.id}_filter input`).trigger("focus")}function Ee(t){const e=$(t.target)
Ie(o(mt,e.attr("invid"),e.attr("action")),e)}function Se(t){const e=$(t.target)
Ie(o(ht,e.attr("invid"),e.attr("playerid"),e.attr("mode"),e.attr("action")),e)}function je(t,e){const n=$(t.target)
Ie(o(e,n.attr("invid")),n)}function De(t){const e=$(t.target)
et([e.data("inv")],e.val())}function Ne(t){const e=$(t.target)
Ie(o(fe,[e.attr("invid")]),e)}function Te(t,e){const n=$(t.target)
Ie(o(e,[n.data("inv")]),n)}function Ae(t,e){$(e[0]).on("click",o(e[1],t))}function Ce(t,e){$(t).on("click",`span.${e[0]}`,e[1])}function Ge(t){!function(t){[["#fshReset",Me],["#fshAll",he],["#fshNone",_e],["#fshDefault",Le]].forEach(o(Ae,t))}(t),$("table.fshInvFilter").on("click",'input[type="checkbox"]',o(Re,t)),function(t){[["setName",o(we,t)],["takeItem",Ee],["recallItem",Se],["wearItem",t=>je(t,ot)],["useItem",t=>je(t,lt)],["dropItem",t=>Te(t,nt)],["sendItem",t=>Te(t,oe)],["storeItem",Ne]].forEach(o(Ce,t))}(t)}let Pe=0
function qe(t,e){return vt(Pe,gt(e[1]),Wt().fshMinLvl,Wt().fshMaxLvl)}function Oe(){Pe=[(t,e,n)=>0===n,...yt],$.fn.dataTable.ext.search.push(qe)}function Ue(){$.fn.dataTable.ext.search.push(((t,e,n,s)=>!Wt().checkedElements||Wt().checkedElements[s.type]))}function Fe(){$.fn.dataTable.ext.search.push(((t,e,n,s)=>!Wt().checkedElements?.[-1]||function(t){return Wt().checkedElements[-1]&&t.stats&&-1!==t.stats.set_id}(s)))}function Be(){$.fn.dataTable.ext.search.push(((t,e,n,s)=>{const a=(parseInt(s.rarity,10)+100).toString()
return!Wt().checkedElements||Wt().checkedElements[a]}))}const We=()=>Mt().player_id?`<b>&nbsp;Inventory Manager</b> ${Mt().items.length} items (green = worn, blue = backpack)`:`<b>&nbsp;Guild Inventory Manager</b> ${Mt().items.length} items (maroon = in BP, blue=guild store)`
function Ve(){kt(Mt().items)&&function(){const t=We()
x("",a()),It()&&Rt(),I(a(),Pt.replace("@@reportTitle@@",t))}()}function He(t){let e,n,s,a,i,r,c,d
return{c(){e=w("div"),n=w("span"),n.textContent="Recall all visible to:",s=E(),a=w("button"),a.textContent="BP",i=E(),r=w("button"),r.textContent="GS",S(a,"class","custombutton svelte-dlcnix"),S(a,"type","button"),S(r,"class","custombutton svelte-dlcnix"),S(r,"type","button"),S(e,"class","svelte-dlcnix")},m(o,l){j(o,e,l),D(e,n),D(e,s),D(e,a),D(e,i),D(e,r),c||(d=[N(a,"click",t[0]),N(r,"click",t[1])],c=!0)},p:T,i:T,o:T,d(t){t&&A(e),c=!1,C(d)}}}function Qe(t){return[function(){G("Inventory","Recall All","toBp"),[...g('span[action="take"]'),...g('span[mode="0"][action="recall"]')].forEach(P)},function(){G("Inventory","Recall All","toGs"),g('span[mode="1"][action="recall"]').forEach(P)}]}class Ye extends R{constructor(t){super(),L(this,t,Qe,He,M,{})}}function Je(){"guildinvmgr"===i.subcmd&&new Ye({target:a()})}function Ke(){$("#fshMinLvl").val(Wt().fshMinLvl),$("#fshMaxLvl").val(Wt().fshMaxLvl)}const Xe=([,t])=>[t.id,t]
function Ze(t){H([Ct,Oe,Ue,Fe,Be,Ve,me,Ke])
const e=de()
!function(t){$("#fshMinLvl, #fshMaxLvl").on("keyup",o(ve,t)),$(t).on("change","select.fshMoveItem",De),Ge(t)}(e),$("#fshRefresh").on("click",t),function(t){const e=$(`#${t.id}_filter input`)
e.prop("type","text")
const n=$("<span>&times;</span>")
e.wrap($('<span class="text-input-wrapper"/>')),e.after(n),n.on("click",o(At,t,e))}(e),Je()}function ze(t){B("JS Perf","getInvMan"),Ze(t),W("JS Perf","getInvMan")}const tn=()=>Object.getOwnPropertyNames(Mt()).length
async function en(e){const n=[Q(),Tt()]
"guildinvmgr"===i.subcmd&&n.push(async function(){await t(!1),i.membrList=U(h(i.membrList).filter(_t).map(Xe))}()),n.push(async function(){const t=await it(`fsh_${i.subcmd}`)
Ut={...K(Gt),...l(t,{})},Ft=u("showQuickDropLinks"),Bt=u("showQuickSendLinks")}()),await V(n),tn()&&function(t){F(3,ze,[t])}(e)}function nn(){!q()&&a()&&("guildinvmgr"!==i.subcmd||c())&&(x(`<span id="fshInvMan"><img src = "${O}">&nbsp;Getting inventory data...</span>`,a()),en(nn))}export{nn as default}
//# sourceMappingURL=inventory-3fc7670b.js.map
