import{a as st}from"./chunk-GFDVBBLT.js";import{a as v}from"./chunk-BD6U2K5T.js";import{a as at}from"./chunk-MT2A3HBW.js";import{a as nt,b as it}from"./chunk-KMUFM4XM.js";import{a as s}from"./chunk-DDSPWTMT.js";import{a as ot}from"./chunk-3XSBFFT3.js";import{a as rt}from"./chunk-X2TXN5H7.js";import{a as y}from"./chunk-I4LE4V5X.js";import{a as tt}from"./chunk-KTCUHC46.js";import{a as g}from"./chunk-ORWNE4WN.js";import{a as et}from"./chunk-3C5ENJEY.js";import{a as J}from"./chunk-UNRPYWV7.js";import{a as Z}from"./chunk-JMVCQWLZ.js";import{a as C}from"./chunk-IITGBJS7.js";import{a as j}from"./chunk-BKJXISW2.js";import{a as w}from"./chunk-MZYLPE6K.js";import{a as X}from"./chunk-VRFSPHR2.js";import{a as n}from"./chunk-GHI2YFAT.js";import{a}from"./chunk-6FE7TFOW.js";import{a as O}from"./chunk-4TGPNPDH.js";import{a as Q}from"./chunk-DGS2WOJV.js";import{b as f}from"./chunk-AXEF7ZPS.js";import{a as h}from"./chunk-L2F37LJS.js";import{a as K}from"./chunk-LXCNYPSV.js";import{a as W}from"./chunk-SUTTQBC4.js";import{a as F}from"./chunk-26QSBXRQ.js";import{a as V}from"./chunk-K4FZKNLQ.js";import{a as b}from"./chunk-OHRM7A4V.js";import{a as p}from"./chunk-TDFIT7OX.js";import{a as z,b as L}from"./chunk-I42VMRRO.js";import{b as d}from"./chunk-ELGHA2UY.js";import{Ka as N,La as U,Ma as u,T as Y,ta as k,v as H}from"./chunk-L5JB47YP.js";var lt=t=>[t,y(t.href,"target_username")],pt=async([t,e])=>[t,e,await nt(e)],ut=t=>t?' class="pmAttackUrl"':"";function dt(t,[e,r]){ot(e,` | <a${ut(t)} href="${Y}${r}">Attack</a>`)}async function P(t,e){let r=n('a[href*="=createsecure&"]',t);if(!r.length)return;let o=r.map(lt);(await Promise.all(o.map(pt))).filter(([,,m])=>!m).forEach(m=>dt(e,m))}var gt=t=>t?' class="pmIgnoreUrl"':"",yt=(t,e)=>`<a${gt(t)} href="${H}${a(e)}" data-tooltip="Add to Ignore List">Ignore</a>`;function ht(t,[e,r]){g(r.cells[1],`<font size="1"><br>[ ${yt(t,e)} ]</font>`)}function x(t,e){let r=n(u,t);if(r.length===0)return;r.map(i=>[i,s(i)]).forEach(i=>ht(e,i))}function S(t){return Z({cmd:"combat",subcmd:"view",combat_id:t})}function A(t){return Q({cmd:"combat",subcmd:"view",combat_id:t})}function mt(t){return Number(t.getAttribute("background").match(/\/(\d+)/)?.[1])}function c(t,e){let r=new RegExp(`${e} = (\\d+)`);return Number(t.match(r)[1])}function bt(t){let e=[[18,"leeched"],[21,"Spell"]].map(([r,o])=>[r,t.includes(o),t.split(" ")[0],t.split("'")[1]]).find(([,r])=>r);return e?{id:e[0],params:[e[2],e[3]]}:(tt("Logs","Missing PvP Special",t),{id:-1,params:["-1","-1"]})}function wt(t){return n("#specialsDiv",t).map(a).filter(i=>["leeched","Spell"].some(m=>i.includes(m))).map(bt)}function vt(t){return{id:mt(t.rows[1].cells[0]),name:a(t.rows[0].cells[0])}}function Tt(t){return{id:mt(t.rows[1].cells[2]),name:a(t.rows[0].cells[2])}}function kt(t,e){let r=e.children[0].rows[5].cells[0].children[0];return{attacker:vt(r),defender:Tt(r),id:Number(t),specials:wt(e)}}function Ct(t){let e=h(t.children[1]);return{gold_gain:c(e,"goldGain"),gold_stolen:c(e,"goldStolen"),pvp_prestige_gain:c(e,"prestigeGain"),pvp_rating_change:c(e,"pvpRatingChange"),winner:c(e,"winner"),xp_gain:c(e,"xpGain")}}function Lt(t,e){return{...kt(t,e),...Ct(e)}}function Pt(t,e){let r=O(e),o=V("pCC",r);return{r:{combat:Lt(t,o)},s:!0}}async function $(t){let e=await A(t);return Pt(t,e)}function _(t){return J(S,$,t)}var E="fsh_pvpCombat",R,T;function xt(t,[e,r]){return e==="lastCheck"||r.logTime&&r.logTime>t}function St(t){let e=f-604800,o=b(t).filter(p(xt,e)),i={...rt(o),lastCheck:f};return L(E,i),i}async function At(){let t=await z(E);if(!t)return{lastCheck:f};let e=f-24*60*60;return!t.lastCheck||t.lastCheck<e?St(t):t}async function $t(t,e,r){let o=await _(e);if(!(!o||!o.s))return T||(T={...r}),T[e]={...o,logTime:v(a(t.cells[1]))/1e3},L(E,T),o}async function G(t,e){R||(R=At());let r=await R;return r[e]&&r[e].logTime?r[e]:$t(t,e,r)}var ct="fshGreen",ft="fshRed",_t=t=>X(N,t),Rt=([,t])=>!/\(Guild Conflict\)/.test(t),Et=async([t,e])=>[t,e,await G(t,/combat_id=(\d+)/.exec(e)[1])];function Gt(t){return/You were victorious over/.test(t)?[ct,`You were <span class="${ct}">victorious</span> over `]:/You were defeated by/.test(t)?[ft,`You were <span class="${ft}">defeated</span> by `]:["",null]}function l(t,e,r){return t!==0?`${e}:<span class="${r}">${F(t)}</span> `:""}function It(t,e){return e.id===18?`${t}<br><span class="fshRed fshBold">${e.params[0]} leeched the buff '${e.params[1]}'.</span>`:e.id===21?`${t}<br><span class="fshRed fshBold">${e.params[0]} was mesmerized by Spell Breaker, losing the '${e.params[1]}' buff.</span>`:t}function Bt(t,e){return l(t.xp_gain,"XP stolen",e)+l(t.gold_gain,"Gold lost",e)+l(t.gold_stolen,"Gold stolen",e)+l(t.pvp_prestige_gain,"Prestige gain",e)+l(t.pvp_rating_change,"PvP change",e)+t.specials.reduce(It,"")}function Dt([t,e,r]){let[o,i]=Gt(e);if(i){let m=Bt(r.r.combat,o);t.cells[2].firstChild.remove(),et(t.cells[2],i),w(t.cells[2],j({innerHTML:m}))}}function qt(t){return t.map(s).filter(_t).map(e=>[e,e.cells[2].innerHTML]).filter(Rt).map(Et)}var Mt=([,,t])=>t&&t.s;async function I(t){let e=n('a[href*="&combat_id="]',t);if(e.length===0)return;(await Promise.all(qt(e))).filter(Mt).forEach(Dt)}function B(t){n('a[href*="=trade&"]',t).filter(e=>!y(e.href,"subcmd")).forEach(e=>C("Trade",e)),n('a[href*="=createsecure&"]',t).forEach(e=>C("ST",e))}function Vt(t,e){let[,,r]=t.rows[0].cells;r&&!e&&g(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Ht(t){let[,e]=await it(t);return[`.fshPlayerColoring tr:nth-of-type(${s(t).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,e]}function Yt(t,[e,r]){return t[r]?t[r].push(e):t[r]=[e],t}var Nt={guild:"green",ally:"blue",enemy:"red"};function Ut([t,e]){return`${e.join(", ")} { color: ${Nt[t]}; }`}var jt=([,t])=>t;function Wt(t){return b(t.filter(jt).reduce(Yt,{})).map(Ut)}function zt(t,e,r){let o=Wt(e);o.length&&(Vt(t,r),t.classList.add("fshPlayerColoring"),w(document.body,at(o.join(`
`))))}async function D(t,e){let r=n(u,t);if(!r.length)return;let o=await Promise.all(r.map(Ht));zt(t,o,e)}var q,Kt=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function Ot(t){return Kt.test(h(t.cells[2]))}function Qt(t){let e=v(a(t.cells[1]));e>q&&(K(k,e),q=e)}function M(t){q=d(k),n(U,t).map(s).filter(Ot).forEach(Qt)}var Xt=[["addIgnoreLink",x],["colorPlayerNames",D],["addAttackLinkToLog",P],["changeButtonLabels",B],["trackLadderReset",M],["showPvPSummaryInLog",I]];function Ft(t,e,r){d(r[0])&&r[1](t,e)}function Jt(t,e){Xt.forEach(p(Ft,t,e))}function Zt(t){if(W())return;let e=st();e&&Jt(e,t)}export{Zt as a};
//# sourceMappingURL=chunk-OEIQGFB6.js.map
