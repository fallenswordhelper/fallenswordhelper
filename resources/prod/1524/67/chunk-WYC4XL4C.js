import{a as pe}from"./chunk-KJREACTX.js";import{a as k}from"./chunk-J2JAQCWL.js";import{a as fe}from"./chunk-5TKHVRM7.js";import{a as le}from"./chunk-NIPXNRB7.js";import{a as m}from"./chunk-CX6XSC6N.js";import{a as ce}from"./chunk-WLALCVHP.js";import{a as ae}from"./chunk-SUWGTJAK.js";import{a as me}from"./chunk-T72LSAK3.js";import{a as w}from"./chunk-AEFPVUQR.js";import{a as ie}from"./chunk-QPL4UDOG.js";import{a as b}from"./chunk-26JISGFW.js";import{a as se}from"./chunk-KQ5WOXHO.js";import{a as oe}from"./chunk-P5WXMFOM.js";import{a as ne}from"./chunk-N2VZWPJP.js";import{a as P}from"./chunk-MPKWYN54.js";import{a as O}from"./chunk-ZXNRU5Y3.js";import{a as v}from"./chunk-OWY2Q2GJ.js";import{a as ee}from"./chunk-QWSDLB5G.js";import{a as i}from"./chunk-FJBSYG3T.js";import{a}from"./chunk-PGXMNMPQ.js";import{a as te}from"./chunk-YLOJQ3K3.js";import{a as J}from"./chunk-4C3N6WGV.js";import{a as Z}from"./chunk-MIOWB4UH.js";import{b as p}from"./chunk-LUOJJ6W7.js";import{a as T}from"./chunk-PUGPLE52.js";import{a as F}from"./chunk-3NPR3CPY.js";import{a as Q}from"./chunk-HTRQRB5B.js";import{a as re}from"./chunk-WRRYWMWJ.js";import{a as N}from"./chunk-THKPSV6M.js";import{a as K}from"./chunk-H4BEXNKD.js";import{a as c}from"./chunk-TBVC64JY.js";import{a as g}from"./chunk-PCBO3IJC.js";import{a as X,b as x}from"./chunk-3DZI6Z43.js";import{b as h}from"./chunk-EGK63SHX.js";import{Ka as W,La as z,Ma as y,T as Y,ta as L,v as U}from"./chunk-ZBCNB5YM.js";var S;async function Te(){return c(await le(!1)).filter(([,e])=>K(e)).map(([e])=>e)}async function u(e){return te()&&!S&&(S=Te()),(await S).includes(e)}var ve=e=>[e,w(e.href,"target_username")],ke=async([e,t])=>[e,t,await u(t)],Ce=e=>e?' class="pmAttackUrl"':"";function Le(e,[t,r]){ce(t,` | <a${Ce(e)} href="${Y}${r}">Attack</a>`)}async function A(e,t){let r=i('a[href*="=createsecure&"]',e);if(!r.length)return;let o=r.map(ve);(await Promise.all(o.map(ke))).filter(([,,s])=>!s).forEach(s=>Le(t,s))}var Pe=e=>e?' class="pmIgnoreUrl"':"",xe=(e,t)=>`<a${Pe(e)} href="${U}${a(t)}" data-tooltip="Add to Ignore List">Ignore</a>`;function Se(e,[t,r]){b(r.cells[1],`<font size="1"><br>[ ${xe(e,t)} ]</font>`)}function _(e,t){let r=i(y,e);if(r.length===0)return;r.map(n=>[n,m(n)]).forEach(n=>Se(t,n))}function $(e){return ne({cmd:"combat",subcmd:"view",combat_id:e})}function E(e){return Z({cmd:"combat",subcmd:"view",combat_id:e})}function ue(e){return Number(e.getAttribute("background").match(/\/(\d+)/)?.[1])}function l(e,t){let r=new RegExp(`${t} = (\\d+)`);return Number(e.match(r)[1])}function Ae(e){let t=[[18,"leeched"],[21,"Spell"]].map(([r,o])=>[r,e.includes(o),e.split(" ")[0],e.split("'")[1]]).find(([,r])=>r);return t?{id:t[0],params:[t[2],t[3]]}:(ie("Logs","Missing PvP Special",e),{id:-1,params:["-1","-1"]})}function _e(e){return i("#specialsDiv",e).map(a).filter(n=>["leeched","Spell"].some(s=>n.includes(s))).map(Ae)}function $e(e){return{id:ue(e.rows[1].cells[0]),name:a(e.rows[0].cells[0])}}function Ee(e){return{id:ue(e.rows[1].cells[2]),name:a(e.rows[0].cells[2])}}function Re(e,t){let r=t.children[0].rows[5].cells[0].children[0];return{attacker:$e(r),defender:Ee(r),id:Number(e),specials:_e(t)}}function Ge(e){let t=T(e.children[1]);return{gold_gain:l(t,"goldGain"),gold_stolen:l(t,"goldStolen"),pvp_prestige_gain:l(t,"prestigeGain"),pvp_rating_change:l(t,"pvpRatingChange"),winner:l(t,"winner"),xp_gain:l(t,"xpGain")}}function Ie(e,t){return{...Re(e,t),...Ge(t)}}function Me(e,t){let r=J(t),o=N("pCC",r);return{r:{combat:Ie(e,o)},s:!0}}async function R(e){let t=await E(e);return Me(e,t)}function G(e){return oe($,R,e)}var M="fsh_pvpCombat",I,C;function Be(e,[t,r]){return t==="lastCheck"||r.logTime&&r.logTime>e}function De(e){let t=p-604800,o=c(e).filter(g(Be,t)),n={...me(o),lastCheck:p};return x(M,n),n}async function qe(){let e=await X(M);if(!e)return{lastCheck:p};let t=p-24*60*60;return!e.lastCheck||e.lastCheck<t?De(e):e}async function Ve(e,t,r){let o=await G(t);if(!(!o||!o.s))return C||(C={...r}),C[t]={...o,logTime:k(a(e.cells[1]))/1e3},x(M,C),o}async function B(e,t){I||(I=qe());let r=await I;return r[t]&&r[t].logTime?r[t]:Ve(e,t,r)}var de="fshGreen",ge="fshRed",He=e=>ee(W,e),je=([,e])=>!/\(Guild Conflict\)/.test(e),Ne=async([e,t])=>[e,t,await B(e,/combat_id=(\d+)/.exec(t)[1])];function Ue(e){return/You were victorious over/.test(e)?[de,`You were <span class="${de}">victorious</span> over `]:/You were defeated by/.test(e)?[ge,`You were <span class="${ge}">defeated</span> by `]:["",null]}function d(e,t,r){return e!==0?`${t}:<span class="${r}">${re(e)}</span> `:""}function Ye(e,t){return t.id===18?`${e}<br><span class="fshRed fshBold">${t.params[0]} leeched the buff '${t.params[1]}'.</span>`:t.id===21?`${e}<br><span class="fshRed fshBold">${t.params[0]} was mesmerized by Spell Breaker, losing the '${t.params[1]}' buff.</span>`:e}function We(e,t){return d(e.xp_gain,"XP stolen",t)+d(e.gold_gain,"Gold lost",t)+d(e.gold_stolen,"Gold stolen",t)+d(e.pvp_prestige_gain,"Prestige gain",t)+d(e.pvp_rating_change,"PvP change",t)+e.specials.reduce(Ye,"")}function ze([e,t,r]){let[o,n]=Ue(t);if(n){let s=We(r.r.combat,o);e.cells[2].firstChild.remove(),se(e.cells[2],n),v(e.cells[2],O({innerHTML:s}))}}function Ke(e){return e.map(m).filter(He).map(t=>[t,t.cells[2].innerHTML]).filter(je).map(Ne)}var Oe=([,,e])=>e&&e.s;async function D(e){let t=i('a[href*="&combat_id="]',e);if(t.length===0)return;(await Promise.all(Ke(t))).filter(Oe).forEach(ze)}function q(e){i('a[href*="=trade&"]',e).filter(t=>!w(t.href,"subcmd")).forEach(t=>P("Trade",t)),i('a[href*="=createsecure&"]',e).forEach(t=>P("ST",t))}var ye=e=>e.username,f;async function he(){let e=await ae(!1);return{_allies:e._allies.map(ye),_enemies:e._enemies.map(ye)}}async function be(e){return f||(f=he()),(await f)._allies.includes(e)}async function we(e){return f||(f=he()),(await f)._enemies.includes(e)}function Qe(e,t){let r=e.rows[0].cells[2];r&&!t&&b(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Xe(e){let t="",r=a(e),[o,n,s]=await Promise.all([u(r),be(r),we(r)]);return o?t="guild":n?t="ally":s&&(t="enemy"),[`.fshPlayerColoring tr:nth-of-type(${m(e).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,t]}function Fe(e,[t,r]){return e[r]?e[r].push(t):e[r]=[t],e}var Je={guild:"green",ally:"blue",enemy:"red"};function Ze([e,t]){return`${t.join(", ")} { color: ${Je[e]}; }`}var et=([,e])=>e;function tt(e){return c(e.filter(et).reduce(Fe,{})).map(Ze)}function rt(e,t,r){let o=tt(t);o.length&&(Qe(e,r),e.classList.add("fshPlayerColoring"),v(document.body,fe(o.join(`
`))))}async function V(e,t){let r=i(y,e);if(!r.length)return;let o=await Promise.all(r.map(Xe));rt(e,o,t)}var H,ot=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function nt(e){return ot.test(T(e.cells[2]))}function it(e){let t=k(a(e.cells[1]));t>H&&(F(L,t),H=t)}function j(e){H=h(L),i(z,e).map(m).filter(nt).forEach(it)}var at=[["addIgnoreLink",_],["colorPlayerNames",V],["addAttackLinkToLog",A],["changeButtonLabels",q],["trackLadderReset",j],["showPvPSummaryInLog",D]];function st(e,t,r){h(r[0])&&r[1](e,t)}function mt(e,t){at.forEach(g(st,e,t))}function ct(e){if(Q())return;let t=pe();t&&mt(t,e)}export{ct as a};
//# sourceMappingURL=chunk-WYC4XL4C.js.map
