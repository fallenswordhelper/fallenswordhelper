import{a as pe}from"./chunk-GPTG7FXT.js";import{a as v}from"./chunk-LRTJ7GLJ.js";import{a as fe}from"./chunk-IS2QR6PF.js";import{a as le}from"./chunk-RC3QFBJU.js";import{a as s}from"./chunk-Q5B3Q7PZ.js";import{a as ce}from"./chunk-UUVNJOHC.js";import{a as ae}from"./chunk-WZE2PBQX.js";import{a as me}from"./chunk-NDE6NJBX.js";import{a as ne}from"./chunk-ZSLT6K5Q.js";import{a as w}from"./chunk-S3GZ4CHY.js";import{a as b}from"./chunk-2CM5F3MT.js";import{a as se}from"./chunk-XTL7D732.js";import{a as oe}from"./chunk-YSBBZLBI.js";import{a as ie}from"./chunk-TEFHJKMD.js";import{a as P}from"./chunk-WT7P376I.js";import{a as O}from"./chunk-MKP6263K.js";import{a as k}from"./chunk-AHVVGVUS.js";import{a as ee}from"./chunk-TSPZQ2SO.js";import{a as n}from"./chunk-2Y4GP7HD.js";import{a}from"./chunk-FJUNK3QD.js";import{a as te}from"./chunk-25UB4FCY.js";import{a as F}from"./chunk-DRKQTEJS.js";import{a as J}from"./chunk-ILQHWW7D.js";import{b as u}from"./chunk-RF4ISCAB.js";import{a as T}from"./chunk-C2QANIAW.js";import{a as X}from"./chunk-REETYBHA.js";import{a as Z}from"./chunk-WZGO2PGN.js";import{a as re}from"./chunk-RCUP3PUI.js";import{a as N}from"./chunk-XSMZ46A3.js";import{a as K}from"./chunk-H5HEKC7D.js";import{a as l}from"./chunk-ID3GPDDL.js";import{a as c}from"./chunk-UD6FQZRC.js";import{a as Q,b as x}from"./chunk-TGEPVDHI.js";import{b as h}from"./chunk-55VGZ4O3.js";import{Ka as z,La as W,Ma as y,T as Y,ta as L,v as U}from"./chunk-TD2HJ4A4.js";var S;async function Te(){return l(await le(!1)).filter(([,e])=>K(e)).map(([e])=>e)}async function d(e){return te()&&!S&&(S=Te()),(await S).includes(e)}var ke=e=>[e,w(e.href,"target_username")],ve=async([e,t])=>[e,t,await d(t)],Ce=e=>e?' class="pmAttackUrl"':"";function Le(e,[t,r]){ce(t,` | <a${Ce(e)} href="${Y}${r}">Attack</a>`)}async function A(e,t){let r=n('a[href*="=createsecure&"]',e);if(!r.length)return;let o=r.map(ke);(await Promise.all(o.map(ve))).filter(([,,m])=>!m).forEach(m=>Le(t,m))}var Pe=e=>e?' class="pmIgnoreUrl"':"",xe=(e,t)=>`<a${Pe(e)} href="${U}${a(t)}" data-tooltip="Add to Ignore List">Ignore</a>`;function Se(e,[t,r]){b(r.cells[1],`<font size="1"><br>[ ${xe(e,t)} ]</font>`)}function _(e,t){let r=n(y,e);if(r.length===0)return;r.map(i=>[i,s(i)]).forEach(i=>Se(t,i))}function $(e){return ie({cmd:"combat",subcmd:"view",combat_id:e})}function E(e){return J({cmd:"combat",subcmd:"view",combat_id:e})}function ue(e){return Number(e.getAttribute("background").match(/\/(\d+)/)?.[1])}function f(e,t){let r=new RegExp(`${t} = (\\d+)`);return Number(e.match(r)[1])}var Ae=[[18,/(\w+)+ leeched the buff '([A-Za-z ]+)'./],[21,/(\w+)+ was mesmerized by Spell Breaker, losing the '([A-Za-z ]+)' buff./]];function _e(e){let t=Ae.map(([r,o])=>[r,e.match(o)]).find(([,r])=>r);return t?{id:t[0],params:[t[1][1],t[1][2]]}:(ne("Logs","Missing PvP Special",e),{id:-1,params:["-1","-1"]})}function $e(e){return n("#specialsDiv",e).map(a).filter(t=>["leeched","Spell"].some(r=>t.includes(r))).map(_e)}function Ee(e){return{id:ue(e.rows[1].cells[0]),name:a(e.rows[0].cells[0])}}function Re(e){return{id:ue(e.rows[1].cells[2]),name:a(e.rows[0].cells[2])}}function Ge(e,t){let r=t.children[0].rows[5].cells[0].children[0];return{attacker:Ee(r),defender:Re(r),id:Number(e),specials:$e(t)}}function Me(e){let t=T(e.children[1]);return{gold_gain:f(t,"goldGain"),gold_stolen:f(t,"goldStolen"),pvp_prestige_gain:f(t,"prestigeGain"),pvp_rating_change:f(t,"pvpRatingChange"),winner:f(t,"winner"),xp_gain:f(t,"xpGain")}}function Ie(e,t){return{...Ge(e,t),...Me(t)}}function Be(e,t){let r=F(t),o=N("pCC",r);return{r:Ie(e,o),s:!0}}function R(e){return E(e).then(c(Be,e))}function G(e){return oe($,R,e)}var M="fsh_pvpCombat",I,C;function De(e,[t,r]){return t==="lastCheck"||r.logTime&&r.logTime>e}function qe(e){let t=u-7*24*60*60,o=l(e).filter(c(De,t)),i={...me(o),lastCheck:u};return x(M,i),i}async function Ve(){let e=await Q(M);if(!e)return{lastCheck:u};let t=u-24*60*60;return!e.lastCheck||e.lastCheck<t?qe(e):e}async function He(e,t,r){let o=await G(t);if(!(!o||!o.s))return C||(C={...r}),C[t]={...o,logTime:v(a(e.cells[1]))/1e3},x(M,C),o}async function B(e,t){I||(I=Ve());let r=await I;return r[t]&&r[t].logTime?r[t]:He(e,t,r)}var de="fshGreen",ge="fshRed",je=e=>ee(z,e),Ne=([,e])=>!/\(Guild Conflict\)/.test(e),Ue=async([e,t])=>[e,t,await B(e,/combat_id=(\d+)/.exec(t)[1])];function Ye(e){return/You were victorious over/.test(e)?[de,`You were <span class="${de}">victorious</span> over `]:/You were defeated by/.test(e)?[ge,`You were <span class="${ge}">defeated</span> by `]:["",null]}function g(e,t,r){return e!==0?`${t}:<span class="${r}">${re(e)}</span> `:""}function ze(e,t){return t.id===18?`${e}<br><span class="fshRed fshBold">${t.params[0]} leeched the buff '${t.params[1]}'.</span>`:t.id===21?`${e}<br><span class="fshRed fshBold">${t.params[0]} was mesmerized by Spell Breaker, losing the '${t.params[1]}' buff.</span>`:e}function We(e,t){return g(e.xp_gain,"XP stolen",t)+g(e.gold_gain,"Gold lost",t)+g(e.gold_stolen,"Gold stolen",t)+g(e.pvp_prestige_gain,"Prestige gain",t)+g(e.pvp_rating_change,"PvP change",t)+e.specials.reduce(ze,"")}function Ke([e,t,r]){let[o,i]=Ye(t);if(i){let m=We(r.r.combat,o);e.cells[2].firstChild.remove(),se(e.cells[2],i),k(e.cells[2],O({innerHTML:m}))}}function Oe(e){return e.map(s).filter(je).map(t=>[t,t.cells[2].innerHTML]).filter(Ne).map(Ue)}var Ze=([,,e])=>e&&e.s;async function D(e){let t=n('a[href*="&combat_id="]',e);if(t.length===0)return;(await Promise.all(Oe(t))).filter(Ze).forEach(Ke)}function q(e){n('a[href*="=trade&"]',e).filter(t=>!w(t.href,"subcmd")).forEach(t=>P("Trade",t)),n('a[href*="=createsecure&"]',e).forEach(t=>P("ST",t))}var ye=e=>e.username,p;async function he(){let e=await ae(!1);return{_allies:e._allies.map(ye),_enemies:e._enemies.map(ye)}}async function be(e){return p||(p=he()),(await p)._allies.includes(e)}async function we(e){return p||(p=he()),(await p)._enemies.includes(e)}function Qe(e,t){let r=e.rows[0].cells[2];r&&!t&&b(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Xe(e){let t="",r=a(e),[o,i,m]=await Promise.all([d(r),be(r),we(r)]);return o?t="guild":i?t="ally":m&&(t="enemy"),[`.fshPlayerColoring tr:nth-of-type(${s(e).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,t]}function Fe(e,[t,r]){return e[r]?e[r].push(t):e[r]=[t],e}var Je={guild:"green",ally:"blue",enemy:"red"};function et([e,t]){return`${t.join(", ")} { color: ${Je[e]}; }`}var tt=([,e])=>e;function rt(e){return l(e.filter(tt).reduce(Fe,{})).map(et)}function ot(e,t,r){let o=rt(t);o.length&&(Qe(e,r),e.classList.add("fshPlayerColoring"),k(document.body,fe(o.join(`
`))))}async function V(e,t){let r=n(y,e);if(!r.length)return;let o=await Promise.all(r.map(Xe));ot(e,o,t)}var H,nt=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function it(e){return nt.test(T(e.cells[2]))}function at(e){let t=v(a(e.cells[1]));t>H&&(X(L,t),H=t)}function j(e){H=h(L),n(W,e).map(s).filter(it).forEach(at)}var st=[["addIgnoreLink",_],["colorPlayerNames",V],["addAttackLinkToLog",A],["changeButtonLabels",q],["trackLadderReset",j],["showPvPSummaryInLog",D]];function mt(e,t,r){h(r[0])&&r[1](e,t)}function ct(e,t){st.forEach(c(mt,e,t))}function lt(e){if(Z())return;let t=pe();t&&ct(t,e)}export{lt as a};
//# sourceMappingURL=chunk-3LFRMBTD.js.map
