import{a as ct}from"./chunk-5YYLDOBZ.js";import{a as w}from"./chunk-ZETGCMXM.js";import{a as st,b as mt}from"./chunk-YCYG7PHJ.js";import{a as it}from"./chunk-5RNXLZQW.js";import{a as at}from"./chunk-3ZTT3JGB.js";import{a as m}from"./chunk-ZZCXMDTU.js";import{a as nt}from"./chunk-3J24NIXU.js";import{a as ot}from"./chunk-ASQDDUAJ.js";import{a as rt}from"./chunk-B3YXDQZ3.js";import{a as g}from"./chunk-LC4JONE7.js";import{a as p}from"./chunk-NCMEUMLE.js";import{a as k}from"./chunk-4C3C77WW.js";import{a as W}from"./chunk-RCXM6IKN.js";import{a as b}from"./chunk-M23P7YNW.js";import{a as i}from"./chunk-ON76EM3G.js";import{a as Y}from"./chunk-ZC2VG7OL.js";import{a as Z}from"./chunk-R7EK2RTK.js";import{a as Q}from"./chunk-RUAHQRDU.js";import{a as f}from"./chunk-HUBAYN2T.js";import{a as h}from"./chunk-QVWND6LG.js";import{a as O}from"./chunk-MCDZT6O2.js";import{a as K,b as L}from"./chunk-2NTPEDIZ.js";import{a as z}from"./chunk-2CZQIOBC.js";import{a as et}from"./chunk-CR3YSYOW.js";import{a as tt}from"./chunk-76PHM2VZ.js";import{a as F}from"./chunk-5EWVRUCY.js";import{a as n}from"./chunk-S7D27425.js";import{d as P,f as X,g as J}from"./chunk-LFT5BCCP.js";import{a as y}from"./chunk-32IJAGRN.js";import{a as T}from"./chunk-JDVJBZWD.js";import{b as d}from"./chunk-7JP44NWZ.js";import{La as U,Ma as u,U as N,ua as C,w as j}from"./chunk-LROIQ2AY.js";var ut=t=>[t,g(t.href,"target_username")],dt=async([t,e])=>[t,e,await st(e)],gt=t=>t?' class="pmAttackUrl"':"";function yt(t,[e,r]){nt(e,` | <a${gt(t)} href="${N}${r}">Attack</a>`)}async function x(t,e){let r=n('a[href*="=createsecure&"]',t);if(!r.length)return;let o=r.map(ut);(await Promise.all(o.map(dt))).filter(([,,s])=>!s).forEach(s=>yt(e,s))}var ht=t=>t?' class="pmIgnoreUrl"':"",bt=(t,e)=>`<a${ht(t)} href="${j}${i(e)}" data-tooltip="Add to Ignore List">Ignore</a>`;function wt(t,[e,r]){p(r.cells[1],`<font size="1"><br>[ ${bt(t,e)} ]</font>`)}function S(t,e){let r=n(u,t);if(r.length===0)return;r.map(a=>[a,m(a)]).forEach(a=>wt(e,a))}function A(t){return tt({cmd:"combat",subcmd:"view",combat_id:t})}function $(t){return Q({cmd:"combat",subcmd:"view",combat_id:t})}var vt=t=>Number(T(/\/(?<id>\d+)/,t.getAttribute("background")));function c(t,e){let r=new RegExp(`${e} = (\\d+)`);return Number(T(r,t))}function Tt(t){let e=[[18,"leeched"],[21,"Spell"]].map(([r,o])=>[r,t.includes(o),t.split(" ")[0],t.split("'")[1]]).find(([,r])=>r);return e?{id:e[0],params:[e[2],e[3]]}:(F("Logs","Missing PvP Special",t),{id:-1,params:["-1","-1"]})}function Ct(t){return n("#specialsDiv",t).map(i).filter(a=>["leeched","Spell"].some(s=>a.includes(s))).map(Tt)}function lt(t,e){return{id:vt(t.rows[1].cells[e]),name:i(t.rows[0].cells[e])}}function kt(t,e){let r=e.children[0].rows[5].cells[0].children[0];return{attacker:lt(r,0),defender:lt(r,2),id:Number(t),specials:Ct(e)}}function Lt(t){let e=f(t.children[1]);return{gold_gain:c(e,"goldGain"),gold_stolen:c(e,"goldStolen"),pvp_prestige_gain:c(e,"prestigeGain"),pvp_rating_change:c(e,"pvpRatingChange"),winner:c(e,"winner"),xp_gain:c(e,"xpGain")}}function Pt(t,e){return{...kt(t,e),...Lt(e)}}function xt(t,e){let r=Z(e),o=Y("pCC",r);return{r:{combat:Pt(t,o)},s:!0}}async function _(t){let e=await $(t);return xt(t,e)}function R(t){return rt(A,_,t)}var I="fsh_pvpCombat",E=null,v=0;function St(t,[e,r]){return e==="lastCheck"||r.logTime&&r.logTime>t}function At(t){let r=h(t).filter(y(St,J())),o={...ot(r),lastCheck:P()};return L(I,o),o}async function $t(){let t=await K(I);return t?!t.lastCheck||t.lastCheck<X()?At(t):t:{lastCheck:P()}}async function _t(t,e,r){let o=await R(e);if(!(!o||!o.s))return v||(v={...r}),v[e]={...o,logTime:w(i(t.cells[1]))/1e3},L(I,v),o}async function B(t,e){E||(E=$t());let r=await E;return r[e]&&r[e].logTime?r[e]:_t(t,e,r)}var ft="fshGreen",pt="fshRed",Rt=t=>t.href.split("=").at(-1),Et=async([t,e,r])=>[e,r,await B(e,Rt(t))],It=([,,t])=>t&&t.s,Bt=t=>[18,21,31].includes(t.id),D=t=>`<span class="fshRed fshBold">${t}.</span>`;function Dt(t){return t.includes("You were victorious over")?[ft,`You were <span class="${ft}">victorious</span> over `]:t.includes("You were defeated by")?[pt,`You were <span class="${pt}">defeated</span> by `]:["",null]}function Gt(t){return t.id===18?D(`${t.params[0]} leeched the buff '${t.params[1]}'`):t.id===21?D(`${t.params[0]} was mesmerized by Spell Breaker, losing the '${t.params[1]}' buff`):D(`${t.params[0]} activated Fist Fight`)}function l(t,e,r){return t!==0?`${e}:<span class="${r}">${et(t)}</span> `:""}function Ht(t,e){let r=t.specials.filter(Bt).map(Gt),o=l(t.xp_gain,"XP stolen",e)+l(t.gold_gain,"Gold lost",e)+l(t.gold_stolen,"Gold stolen",e)+l(t.pvp_prestige_gain,"Prestige gain",e)+l(t.pvp_rating_change,"PvP change",e);return o+(o&&r.length?"<br>":"")+(r.length?`${r.join("<br>")}`:"")}function Mt([t,e,r]){let[o,a]=Dt(e);a&&(t.cells[2].firstChild.remove(),it(t.cells[2],a));let s=Ht(r.r.combat,o);s&&b(t.cells[2],W({innerHTML:s}))}function Vt(t){return t.map(e=>[e,m(e)]).map(([e,r])=>[e,r,r.cells[2].innerHTML]).map(Et)}async function G(t){let e=n('a[href*="&combat_id="]',t);if(e.length===0)return;(await Promise.all(Vt(e))).filter(It).forEach(Mt)}function H(t){n('a[href*="=trade&"]',t).filter(e=>!g(e.href,"subcmd")).forEach(e=>k("Trade",e)),n('a[href*="=createsecure&"]',t).forEach(e=>k("ST",e))}function qt(t,e){let[,,r]=t.rows[0].cells;r&&!e&&p(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Yt(t){let[,e]=await mt(t);return[`.fshPlayerColoring tr:nth-of-type(${m(t).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,e]}function jt(t,[e,r]){return t[r]?t[r].push(e):t[r]=[e],t}var Nt={guild:"green",ally:"blue",enemy:"red"};function Ut([t,e]){return`${e.join(", ")} { color: ${Nt[t]}; }`}var Ft=([,t])=>t;function Wt(t){return h(t.filter(Ft).reduce(jt,{})).map(Ut)}function zt(t,e,r){let o=Wt(e);o.length&&(qt(t,r),t.classList.add("fshPlayerColoring"),b(document.body,at(o.join(`
`))))}async function M(t,e){let r=n(u,t);if(!r.length)return;let o=await Promise.all(r.map(Yt));zt(t,o,e)}var V=0,Kt=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function Ot(t){return Kt.test(f(t.cells[2]))}function Qt(t){let e=w(i(t.cells[1]));e>V&&(O(C,e),V=e)}function q(t){V=d(C),n(U,t).map(m).filter(Ot).forEach(Qt)}var Xt=[["addIgnoreLink",S],["colorPlayerNames",M],["addAttackLinkToLog",x],["changeButtonLabels",H],["trackLadderReset",q],["showPvPSummaryInLog",G]];function Jt(t,e,[r,o]){d(r)&&o(t,e)}function Zt(t,e){Xt.forEach(y(Jt,t,e))}function te(t){if(z())return;let e=ct();e&&Zt(e,t)}export{te as a};
//# sourceMappingURL=chunk-OIOUUJYR.js.map
