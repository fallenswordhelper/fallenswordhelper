import{g as t}from"./getMembrList-392b991f.js"
import{ad as e,E as n,c as i,aH as s,bL as a,f as r,bn as d,af as c,cv as o,cE as l,bp as u,C as f,i as p,p as m,bG as h,G as b,$ as y,j as v,aG as g,aL as _,s as k,S as x,L as I,M as R,N as L,O as M,P as E,R as w,T as S,W as j,Y as T,Z as D,_ as N,n as G,ax as P,w as q,bQ as A,aP as C,bM as U,bN as O}from"./calfSystem-34913441.js"
import{a as B}from"./all-414e0607.js"
import{e as F}from"./executeAll-ef9da8be.js"
import{l as V}from"./loadDataTables-f80b56a0.js"
import{d as W,a as H,b as Q}from"./deepClone-a6c4cce9.js"
import{d as Y}from"./daLoadInventory-95693dd0.js"
import{g as X}from"./getInventory-11b76fa4.js"
import{c as J}from"./createTable-407ce13c.js"
import{g as Z,s as z}from"./idb-ec5d6344.js"
import{i as K}from"./isSelected-5d9f5edf.js"
import{d as tt,m as et,a as nt}from"./dropItem-5553463c.js"
import{a as it,e as st,u as at}from"./useItem-5c7e6ad3.js"
import{g as rt}from"./guildInventory-ca591da6.js"
import{h as dt}from"./htmlResult-c11d9ef0.js"
import{e as ct}from"./errorDialog-91872536.js"
import{q as ot,a as lt}from"./queue-209906b8.js"
import{c as ut}from"./changeMinMax-d4bd1aea.js"
import{p as ft,l as pt}from"./lvlTests-3097e750.js"
import{i as mt}from"./intValue-e1798d0a.js"
import"./guildMembers-3d3812de.js"
import"./now-6f22aec9.js"
import"./guild-014ef050.js"
import"./inventory-ed909da9.js"
import"./dialog-d1c54012.js"
import"./dialogMsg-7c5fba89.js"
import"./sendItems-21d6a040.js"
import"./daUseItem-d57bb3e8.js"
import"./InfoBoxFrom-6333b8b3.js"
import"./backpackOk-58e48270.js"
import"./takeItem-61ec1dcf.js"
import"./numberIsNaN-a40c3bbb.js"
function ht([t]){return"lastUpdate"!==t}let bt={},yt=[],vt=[],gt=[],_t=!1,kt={}
const $t=()=>kt
async function xt(){try{const t=await X()
t&&function(t){kt=t}(t)}catch(t){500===t.jqXhr.status&&(_t=!0)}}const It=t=>15===t.t
async function Rt(t){const e=await t()
if(n(e?.r))return yt=yt.concat(e.r.filter(It)),e.r}function Lt(t,e){return e.a===t}function Mt(t){if(15===t.type){const e=yt.find(i(Lt,t.inv_id))
e&&(t.item_name=e.n)}}const Et=["Perfect","Excellent","Very Good","Good","Average","Poor","Uncrafted"],wt=t=>({...t,equipped:!0,folder_id:-2}),St=({id:t,name:e})=>[t,e],jt=t=>({...t,player:{id:-1}}),Tt=({id:t,items:e})=>e.map((e=>({...e,folder_id:t}))),Dt=t=>({craft:t.cr?Et[t.cf]:"",durability:t.cd,equipped:t.equipped??!1,...t.folder_id&&{folder_id:t.folder_id},forge:t.hf??0,guild_tag:t.tg??-1,inv_id:t.a,item_id:t.b,item_name:t.n,max_durability:t.md,...t.player?.id&&{player_id:t.player.id},rarity:t.r,stats:{min_level:t.l,set_name:""},type:t.t})
function Nt(){kt={..."guildinvmgr"===e.subcmd&&{current_player_id:s(),guild_id:a()},items:[],..."invmanagernew"===e.subcmd&&{player_id:s()}},(gt.length||vt.length)&&(kt.items=gt.concat(vt.map(jt)).map(Dt)),n(bt.inventories)&&(kt.folders=r(bt.inventories.map(St)),kt.items=bt.equipment.map(wt).concat(bt.inventories.flatMap(Tt)).map(Dt))}function Gt(){_t?Nt():n(kt?.items)&&kt.items.forEach(Mt)}async function Pt(){const t=[xt()]
"invmanagernew"===e.subcmd&&t.push(async function(){const t=await Y()
n(t?.r?.inventories)&&(bt=t.r,yt=t.r.inventories.flatMap((t=>t.items)).filter(It))}()),"guildinvmgr"===e.subcmd&&(t.push(async function(){const t=await Rt(W)
t&&(vt=t)}()),t.push(async function(){const t=await Rt(H)
t&&(gt=t)}())),await B(t),Gt()}function qt(t,e){e.val(""),$(t).DataTable().search("").draw()}function At(){$t().folders&&($t().folders[-1]="Main")}const Ct={checkedElements:{0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},fshMinLvl:1,fshMaxLvl:9999},Ut='<table class="fshInvFilter"><tr><th colspan="14">@@reportTitle@@</th><th><span id="fshRefresh" class="fshLink">[Refresh]</span></th></tr><tr><td colspan="2" rowspan="3"><b>&nbsp;Show Items:</b></td><td class="fshRight">&nbsp;Helmet:</td><td><input id="fshHelmet" type="checkbox" item="0"/></td><td class="fshRight">&nbsp;Armor:</td><td><input id="fshArmor" type="checkbox" item="1"/></td><td class="fshRight">&nbsp;Gloves:</td><td><input id="fshGloves" type="checkbox" item="2"/></td><td class="fshRight">&nbsp;Boots:</td><td><input id="fshBoots" type="checkbox" item="3"/></td><td class="fshRight">&nbsp;Weapon:</td><td><input id="fshWeapon" type="checkbox" item="4"/></td><td></td><td class="fshRight">&nbsp;Min lvl:</td><td rowspan="2"><input id="fshMinLvl" class="fshNumberInput" type="number" value="1" min="0"><br><input id="fshMaxLvl" class="fshNumberInput" type="number" value="9999" min="0"></td></tr><tr><td class="fshRight">&nbsp;Shield:</td><td><input id="fshShield" type="checkbox" item="5"/></td><td class="fshRight">&nbsp;Ring:</td><td><input id="fshRing" type="checkbox" item="6"/></td><td class="fshRight">&nbsp;Amulet:</td><td><input id="fshAmulet" type="checkbox" item="7"/></td><td class="fshRight">&nbsp;Rune:</td><td><input id="fshRune" type="checkbox" item="8"/></td><td class="fshRight">&nbsp;Sets Only:</td><td><input id="fshSets" item="-1" type="checkbox"/></td><td></td><td class="fshRight">&nbsp;Max lvl:</td></tr><tr><td colspan="2">&nbsp;[<span id="fshAll" class="fshLink">Select All</span>]</td><td colspan="2">&nbsp;[<span id="fshNone" class="fshLink">Select None</span>]</td><td colspan="2">&nbsp;[<span id="fshDefault" class="fshLink">Defaults</span>]</td><td colspan="6"></td><td><input id="fshReset" type="button" value="Reset"/></td></tr><tr><td class="fshRight">&nbsp;Quest Item:</td><td><input id="fshQuest" item="9" type="checkbox"/></td><td class="fshRight">&nbsp;Potion:</td><td><input id="fshPotion" item="10" type="checkbox"/></td><td class="fshRight">&nbsp;Resource:</td><td><input id="fshResource" item="12" type="checkbox"/></td><td class="fshRight">&nbsp;Recipe:</td><td><input id="fshRecipe" item="13" type="checkbox"/></td><td class="fshRight">&nbsp;Container:</td><td><input id="fshContainer" item="14" type="checkbox"/></td><td class="fshRight">&nbsp;Frag Stash:</td><td><input id="fshStash" item="16" type="checkbox"/></td><td class="fshRight">&nbsp;Composed:</td><td><input id="fshComposed" item="15" type="checkbox"/></td><td></td></tr><tr><td class="fshRight">&nbsp;Common:</td><td><input id="fshCommon" item="100" type="checkbox" checked/></td><td class="fshRight">&nbsp;Rare:</td><td><input id="fshRare" item="101" type="checkbox" checked/></td><td class="fshRight">&nbsp;Unique:</td><td><input id="fshUnique" item="102" type="checkbox" checked/></td><td class="fshRight">&nbsp;Legendary:</td><td><input id="fshLegendary" item="103" type="checkbox" checked/></td><td class="fshRight">&nbsp;Super Elite:</td><td><input id="fshSuperElite" item="104" type="checkbox" checked/></td><td class="fshRight">&nbsp;Crystalline:</td><td><input id="fshCrystalline" item="105" type="checkbox" checked/></td><td class="fshRight">&nbsp;Epic:</td><td colspan="2"><input id="fshEpic" item="106" type="checkbox" checked/></td></tr></table>',Ot={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},Bt={Perfect:{abbr:"Perf",colour:"#00b600",index:8},Excellent:{abbr:"Exc",colour:"#f6ed00",index:7},"Very Good":{abbr:"VG",colour:"#f67a00",index:6},Good:{abbr:"Good",colour:"#f65d00",index:5},Average:{abbr:"Ave",colour:"#f64500",index:4},Poor:{abbr:"Poor",colour:"#f61d00",index:3},"Very Poor":{abbr:"VPr",colour:"#b21500",index:2},Uncrafted:{abbr:"Unc",colour:"#666666",index:1}}
let Ft={},Vt=0,Wt=0
const Ht=()=>Ft,Qt=()=>Vt,Yt=()=>Wt
function Xt(t){return Bt[t]?Bt[t].abbr:""}function Jt(t,e){const n=function(t){return t.folder_id?function(t){return t.equipped?"fshGreen":"fshNavy"}(t):function(t){return-1===t.player_id?"fshNavy":"fshMaroon"}(t)}(e)
t.classList.add(n)}function Zt(t){return function(t){return t.player_id&&-1!==t.player_id}(t)||function(t){return t.folder_id&&-1!==t.guild_tag}(t)}function zt(t){return`<span class="fshLink recallItem" invid="${t.inv_id}" playerid="${d(t.player_id,$t().player_id)}" mode="1" action="recall">GS</span>`}function Kt(t){return`<span class="fshLink storeItem" invid="${t.inv_id}">GS</span>`}function te(t,e,n){return"display"===t?n(e):"GS"}function ee(t,e){const n=function(t){return-1===t.player_id?4:Zt(t)?7:1}(e),i=(s=$t().player_id,a=e.player_id,r=$t().guild_id,s||(-1!==a?a:r))
var s,a,r
let d=t
e.equipped&&(d=`<b>${t}</b>`)
let c=""
return function(t){return t.stats&&""!==t.stats.set_name}(e)&&(c=` (<span class="fshLink setName" set="${e.stats.set_name}">set</span>)`),`<a href="${o}${t}" class="fshInvItem tip-dynamic ${l[e.rarity].clas}" data-tipped="fetchitem.php?item_id=${e.item_id}&inv_id=${e.inv_id}&t=${n}&p=${i}">${d}</a>${c}`}const ne=[[t=>t.player_id&&-1===t.player_id,(t,e)=>`takeItem" action="${e.a}`],[t=>t.player_id&&t.player_id!==$t().current_player_id,(t,e)=>`recallItem" playerid="${t.player_id}" mode="0" action="${e.a}`],[t=>function(t){return t.folder_id&&!t.equipped}(t)||function(t){return t.player_id&&!t.equipped&&t.player_id===$t().current_player_id}(t),(t,e)=>e.c]]
function ie(t,e){const n=ne.find((([e])=>e(t)))
return n?`<span class="fshLink ${n[1](t,e)}" invid="${t.inv_id}">${e.b}</span>`:""}function se(t){return d(t.folder_id,t.player_id)}function ae(t){return e.membrList[t]?e.membrList[t].username:"???"}function re(t,e){return t[0]-e[0]}function de(t,e){return`<option value="${e[0]}"${K(Number(e[0]),t)}>${e[1]}</option>`}const ce=[{title:"Name",data:"item_name",render:function(t,e,n){return"display"!==e?t:ee(t,n)}},{title:"Level",data:"stats.min_level"},{title:"Where",data:se,render:{_:function(t,e,n){return n.folder_id?function(t){return t.equipped?-2:t.folder_id}(n):-1===n.player_id?"~":ae(n.player_id)},display:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":`<a class="fshMaroon" href="${u}${t.player_id}">${ae(t.player_id)}</a>`}(n):n.equipped?"Worn":`<select class="fshMoveItem" data-inv="${n.inv_id}">${s=n.folder_id,a=$t().folders,f(a).sort(re).map(i(de,s)).join("")}</select>`
var s,a},filter:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":ae(t.player_id)}(n):n.equipped?"Worn":$t().folders[n.folder_id]}}},{title:"Type",data:"type",render:t=>h[t]},{title:"Att",data:"stats.attack"},{title:"Def",data:"stats.defense"},{title:"Arm",data:"stats.armor"},{title:"Dam",data:"stats.damage"},{title:"HP",data:"stats.hp"},{title:"Frg",data:"forge",render:function(t,e,n){if(n.type<9)return n.forge}},{title:"Craft",data:"craft",render:{_:t=>Bt[t]?Bt[t].index:0,display:Xt,filter:Xt}},{title:"Du%",data:"durability",render:function(t,e,n){if(n.type<9&&n.max_durability>0)return Math.ceil(n.durability/n.max_durability*100)}},{title:"BP",data:se,render:function(t,e,n){if(!n.folder_id&&n.player_id!==$t().current_player_id)return function(t,e){return"display"!==t?"BP":-1===e.player_id?`<span class="fshLink takeItem" invid="${e.inv_id}" action="take">BP</span>`:`<span class="fshLink recallItem" invid="${e.inv_id}" playerid="${e.player_id}" mode="0" action="recall">BP</span>`}(e,n)}},{title:"GS",data:se,render:function(t,e,n){return Zt(n)?te(e,n,zt):function(t){return t.folder_id&&!t.bound}(n)?te(e,n,Kt):void 0}},{title:"W/U",data:"type",render:function(t,e,n){const i=[1,1,1,1,1,1,1,1,1,null,2,2,null,null,null,2][t]
return 1===i?ie(n,{a:"wear",b:"Wear",c:"wearItem"}):2===i?ie(n,{a:"use",b:"Use",c:"useItem"}):void 0}},{title:"setName",data:"stats.set_name",orderable:!1,visible:!1},{title:"Tag",data:"guild_tag",render:t=>-1===t?"No":"Yes"},{title:"Drop",data:"type",render:function(t,e,n){if(!function(t){return-1!==t.guild_tag||t.equipped}(n))return"display"!==e?"Drop":`<span class="dropItem dropLink" data-tooltip="INSTANTLY DESTROY THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Drop</span>`}},{title:"Send",data:"type",render:function(t,e,n){if(!function(t){return t.equipped||-1===t.guild_tag&&t.bound}(n))return"display"!==e?"Send":`<span class="sendItem sendLink" data-tooltip="INSTANTLY SEND THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Send</span>`}}]
function oe(){return"player_id"in $t()}function le(){const t=function(){const t=J({className:"hover fshXSmall",id:oe()?"fshUserInv":"fshGuildInv"})
return p(m(),t),t}(),e=function(t){return $(t).DataTable({autoWidth:!1,columnDefs:[{targets:"_all",defaultContent:""},{targets:[1,4,5,6,7,8,9,10,12,13],orderSequence:["desc","asc"]}],columns:ce,createdRow:Jt,data:$t().items,deferRender:!0,lengthMenu:[[50,100,150,200,-1],[50,100,150,200,"All"]],pageLength:50,stateDuration:0,stateSave:!0})}(t)
return function(t){[[12,"current_player_id"in $t()],[17,oe()&&Qt()],[18,oe()&&Yt()]].forEach((([e,n])=>t.column(e).visible(n)))}(e),t}async function ue(t){const e=await tt(t)
return it(e)}function fe(t){return rt({subcmd2:"dostoreitems",items:t})}async function pe(t){const e=await b({cmd:"guild",subcmd:"inventory",subcmd2:"dostoreitems",storeIndex:t})
return dt(e)}async function me(t){const e=await function(t){return y(fe,pe,t)}(t)
return ct(e),it(e)}function he(t){z(`fsh_${e.subcmd}`,t)}function be(){v('table.fshInvFilter input[type="checkbox"]').forEach((t=>{t.checked=1===Ht().checkedElements[t.getAttribute("item")]})),he(Ht())}function ye(t){Ht().checkedElements=Ot,be(),$(t).DataTable().draw(!1)}function ve(t,e){Ht().fshMinLvl=t,Ht().fshMaxLvl=e,he(Ht())}function ge(t){$(t).DataTable().draw(!1)}function _e(t){ut(ve,i(ge,t))}function ke(t){return Number(t[0])>=100}function $e(t,e){return t[e[0]]=e[1],t}function xe(t){var e
Ht().checkedElements=(e=Ht().checkedElements,f(e).filter(ke).reduce($e,{})),be(),$(t).DataTable().draw()}function Ie(t,e){t.eq(e).empty()}function Re(t,e){if(1===e.r)return
const n=t.closest("tr")
!function(t){[2,12,13,14,15,16].forEach(i(Ie,t))}($("td",n)),n.css("text-decoration","line-through")}async function Le(t,e){g(e),function(t){t.closest("tr").find(".takeItem, .recallItem, .wearItem, .dropItem, .sendItem, .storeItem").removeClass()}(e),function(t){t.empty().append(`<img src="${_}ui/misc/spinner.gif" width="11" height="11">`)}(e)
const n=await t()
n&&Re(e,n)}function Me(t){Ht().checkedElements={},v('table.fshInvFilter input[type="checkbox"][item]:checked').forEach((t=>{Ht().checkedElements[t.getAttribute("item")]=1})),he(Ht()),$(t).DataTable().draw(!1)}function Ee(t){Ht().checkedElements=Ct.checkedElements,be(),$(t).DataTable().draw(!1)}function we(t){Ht().fshMinLvl=Ct.fshMinLvl,Ht().fshMaxLvl=Ct.fshMaxLvl,he(Ht()),function(t){$("#fshMinLvl").val(Ht().fshMinLvl),$("#fshMaxLvl").val(Ht().fshMaxLvl),$(t).DataTable().draw(!1)}(t)}function Se(t,e){$(t).DataTable().search($(e.target).attr("set")).draw(),$(`#${t.id}_filter input`).trigger("focus")}function je(t){const e=$(t.target)
Le(i(ot,e.attr("invid"),e.attr("action")),e)}function Te(t){const e=$(t.target)
Le(i(lt,e.attr("invid"),e.attr("playerid"),e.attr("mode"),e.attr("action")),e)}function De(t,e){const n=$(t.target)
Le(i(e,n.attr("invid")),n)}function Ne(t){const e=$(t.target)
et([e.data("inv")],e.val())}function Ge(t){const e=$(t.target)
Le(i(me,[e.attr("invid")]),e)}function Pe(t,e){const n=$(t.target)
Le(i(e,[n.data("inv")]),n)}function qe(t,e){$(e[0]).on("click",i(e[1],t))}function Ae(t,e){$(t).on("click",`span.${e[0]}`,e[1])}function Ce(t){!function(t){[["#fshReset",we],["#fshAll",ye],["#fshNone",xe],["#fshDefault",Ee]].forEach(i(qe,t))}(t),$("table.fshInvFilter").on("click",'input[type="checkbox"]',i(Me,t)),function(t){[["setName",i(Se,t)],["takeItem",je],["recallItem",Te],["wearItem",t=>De(t,st)],["useItem",t=>De(t,at)],["dropItem",t=>Pe(t,nt)],["sendItem",t=>Pe(t,ue)],["storeItem",Ge]].forEach(i(Ae,t))}(t)}let Ue=0
function Oe(t,e){return pt(Ue,mt(e[1]),Ht().fshMinLvl,Ht().fshMaxLvl)}function Be(){Ue=[(t,e,n)=>0===n,...ft],$.fn.dataTable.ext.search.push(Oe)}function Fe(){$.fn.dataTable.ext.search.push(((t,e,n,i)=>!Ht().checkedElements||Ht().checkedElements[i.type]))}function Ve(){$.fn.dataTable.ext.search.push(((t,e,n,i)=>!Ht().checkedElements||!Ht().checkedElements[-1]||function(t){return Ht().checkedElements[-1]&&t.stats&&-1!==t.stats.set_id}(i)))}function We(){$.fn.dataTable.ext.search.push(((t,e,n,i)=>{const s=(parseInt(i.rarity,10)+100).toString()
return!Ht().checkedElements||Ht().checkedElements[s]}))}function He(){if(!n($t().items))return
let t=""
t=$t().player_id?`<b>&nbsp;Inventory Manager</b> ${$t().items.length} items (green = worn, blue = backpack)`:`<b>&nbsp;Guild Inventory Manager</b> ${$t().items.length} items (maroon = in BP, blue=guild store)`,k(Ut.replace("@@reportTitle@@",t),m())}function Qe(t){let e,n,i,s,a,r,d,c
return{c(){e=L("div"),n=L("span"),n.textContent="Recall all visible to:",i=M(),s=L("button"),s.textContent="BP",a=M(),r=L("button"),r.textContent="GS",E(s,"class","custombutton svelte-dlcnix"),E(s,"type","button"),E(r,"class","custombutton svelte-dlcnix"),E(r,"type","button"),E(e,"class","svelte-dlcnix")},m(o,l){w(o,e,l),S(e,n),S(e,i),S(e,s),S(e,a),S(e,r),d||(c=[j(s,"click",t[0]),j(r,"click",t[1])],d=!0)},p:T,i:T,o:T,d(t){t&&D(e),d=!1,N(c)}}}function Ye(t){return[function(){G("Inventory","Recall All","toBp"),[...v('span[action="take"]'),...v('span[mode="0"][action="recall"]')].forEach(P)},function(){G("Inventory","Recall All","toGs"),v('span[mode="1"][action="recall"]').forEach(P)}]}class Xe extends x{constructor(t){super(),I(this,t,Ye,Qe,R,{})}}function Je(){"guildinvmgr"===e.subcmd&&new Xe({target:m()})}function Ze(){$("#fshMinLvl").val(Ht().fshMinLvl),$("#fshMaxLvl").val(Ht().fshMaxLvl)}const ze=([,t])=>[t.id,t]
function Ke(t){F([At,Be,Fe,Ve,We,He,be,Ze])
const e=le()
!function(t){$("#fshMinLvl, #fshMaxLvl").on("keyup",i(_e,t)),$(t).on("change","select.fshMoveItem",Ne),Ce(t)}(e),$("#fshRefresh").on("click",t),function(t){const e=$(`#${t.id}_filter input`)
e.prop("type","text")
const n=$("<span>&times;</span>")
e.wrap($('<span class="text-input-wrapper"/>')),e.after(n),n.on("click",i(qt,t,e))}(e),Je()}function tn(t){U("JS Perf","getInvMan"),Ke(t),O("JS Perf","getInvMan")}async function en(n){const i=[V(),Pt()]
"guildinvmgr"===e.subcmd&&i.push(async function(){await t(!1),e.membrList=r(f(e.membrList).filter(ht).map(ze))}()),i.push(async function(){const t=await Z(`fsh_${e.subcmd}`)
Ft={...Q(Ct),...d(t,{})},Vt=c("showQuickDropLinks"),Wt=c("showQuickSendLinks")}()),await B(i),function(t){C(3,tn,[t])}(n)}function nn(){!q()&&m()&&("guildinvmgr"!==e.subcmd||a())&&(k(`<span id="fshInvMan"><img src = "${A}">&nbsp;Getting inventory data...</span>`,m()),en(nn))}export{nn as default}
//# sourceMappingURL=inventory-ab576dc7.js.map
