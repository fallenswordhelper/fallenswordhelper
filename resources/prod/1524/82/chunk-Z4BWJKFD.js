import{a as le}from"./chunk-XRXGV3LH.js";import{a as w}from"./chunk-DPBN5K6P.js";import{a as me,b as ce}from"./chunk-GXU6ES7T.js";import{a as se}from"./chunk-V7BL6CYV.js";import{a as ae}from"./chunk-KP7ZLXCF.js";import{a as s}from"./chunk-FWL2OWGY.js";import{a as oe}from"./chunk-V2MYCZVJ.js";import{a as ie}from"./chunk-PTHOXQXD.js";import{a as ne}from"./chunk-CKXQAU55.js";import{a as c}from"./chunk-6BVGCO3I.js";import{a as u}from"./chunk-YVPYZHJW.js";import{a as z}from"./chunk-VKNAZHSW.js";import{a as O}from"./chunk-3KOSRNPL.js";import{a as K}from"./chunk-SGIZTIIQ.js";import{a as P}from"./chunk-6LDE5WBM.js";import{a as F}from"./chunk-QGV7XG72.js";import{a as b}from"./chunk-QPQYH7ZQ.js";import{a}from"./chunk-C7PIQX7O.js";import{a as n}from"./chunk-6ZR46QZG.js";import{a as V}from"./chunk-5E32VBFN.js";import{d as L,f as te,g as re}from"./chunk-N47W3DMT.js";import{a as W}from"./chunk-ZDEOOWYD.js";import{a as p}from"./chunk-MFXNKIYL.js";import{a as X}from"./chunk-JZI3CAHX.js";import{a as Q}from"./chunk-L5KUFFVQ.js";import{a as h}from"./chunk-WBTHTD34.js";import{a as J}from"./chunk-FPGEPPZC.js";import{a as y}from"./chunk-G34A357Q.js";import{a as ee,b as k}from"./chunk-QL5YK4M4.js";import{a as Z}from"./chunk-LG3KLILQ.js";import{a as T}from"./chunk-IWCA3B2P.js";import{b as g}from"./chunk-EEF6C5L4.js";import{La as j,Ma as N,Na as d,U as Y,ua as C,w as U}from"./chunk-KWAUBU52.js";var de=e=>[e,c(e.href,"target_username")],ge=async([e,t])=>[e,t,await me(t)],ye=e=>e?' class="pmAttackUrl"':"";function he(e,[t,r]){ie(t,` | <a${ye(e)} href="${Y}${r}">Attack</a>`)}async function x(e,t){let r=n('a[href*="=createsecure&"]',e);if(!r.length)return;let o=r.map(de);(await Promise.all(o.map(ge))).filter(([,,m])=>!m).forEach(m=>he(t,m))}var be=e=>e?' class="pmIgnoreUrl"':"",we=(e,t)=>`<a${be(e)} href="${U}${a(t)}" data-tooltip="Add to Ignore List">Ignore</a>`;function ve(e,[t,r]){u(r.cells[1],`<font size="1"><br>[ ${we(e,t)} ]</font>`)}function S(e,t){let r=n(d,e);if(r.length===0)return;r.map(i=>[i,s(i)]).forEach(i=>ve(t,i))}function A(e){return K({cmd:"combat",subcmd:"view",combat_id:e})}function $(e){return Q({cmd:"combat",subcmd:"view",combat_id:e})}var Te=e=>Number(T(/\/(?<id>\d+)/,e.getAttribute("background")));function l(e,t){let r=new RegExp(`${t} = (\\d+)`);return Number(T(r,e))}function Ce(e){let t=[[18,"leeched"],[21,"Spell"]].map(([r,o])=>[r,e.includes(o),e.split(" ")[0],e.split("'")[1]]).find(([,r])=>r);return t?{id:t[0],params:[t[2],t[3]]}:(z("Logs","Missing PvP Special",e),{id:-1,params:["-1","-1"]})}function Pe(e){return n("#specialsDiv",e).map(a).filter(i=>["leeched","Spell"].some(m=>i.includes(m))).map(Ce)}function fe(e,t){return{id:Te(e.rows[1].cells[t]),name:a(e.rows[0].cells[t])}}function ke(e,t){let r=t.children[0].rows[5].cells[0].children[0];return{attacker:fe(r,0),defender:fe(r,2),id:Number(e),specials:Pe(t)}}function Le(e){let t=p(e.children[1]);return{gold_gain:l(t,"goldGain"),gold_stolen:l(t,"goldStolen"),pvp_prestige_gain:l(t,"prestigeGain"),pvp_rating_change:l(t,"pvpRatingChange"),winner:l(t,"winner"),xp_gain:l(t,"xpGain")}}function xe(e,t){return{...ke(e,t),...Le(t)}}function Se(e,t){let r=X(t),o=V("pCC",r);return{r:{combat:xe(e,o)},s:!0}}async function _(e){let t=await $(e);return Se(e,t)}function R(e){return O(A,_,e)}var I="fsh_pvpCombat",E=0,v=0;function Ae(e,[t,r]){return t==="lastCheck"||r.logTime&&r.logTime>e}function $e(e){let r=h(e).filter(y(Ae,re())),o={...ne(r),lastCheck:L()};return k(I,o),o}async function _e(){let e=await ee(I);return e?!e.lastCheck||e.lastCheck<te()?$e(e):e:{lastCheck:L()}}async function Re(e,t,r){let o=await R(t);if(!(!o||!o.s))return v||(v={...r}),v[t]={...o,logTime:w(a(e.cells[1]))/1e3},k(I,v),o}async function B(e,t){E||(E=_e());let r=await E;return r[t]&&r[t].logTime?r[t]:Re(e,t,r)}var pe="fshGreen",ue="fshRed",Ee=([,e])=>W(j,e),Ie=async([e,t,r])=>[t,r,await B(t,c(e.href,"combat_id"))];function Be(e){return e.includes("You were victorious over")?[pe,`You were <span class="${pe}">victorious</span> over `]:e.includes("You were defeated by")?[ue,`You were <span class="${ue}">defeated</span> by `]:["",null]}function f(e,t,r){return e!==0?`${t}:<span class="${r}">${oe(e)}</span> `:""}var Ge=e=>[18,21].includes(e.id);function De(e){return e.id===18?`<span class="fshRed fshBold">${e.params[0]} leeched the buff '${e.params[1]}'.</span>`:`<span class="fshRed fshBold">${e.params[0]} was mesmerized by Spell Breaker, losing the '${e.params[1]}' buff.</span>`}function qe(e,t){let r=e.specials.filter(Ge).map(De),o=f(e.xp_gain,"XP stolen",t)+f(e.gold_gain,"Gold lost",t)+f(e.gold_stolen,"Gold stolen",t)+f(e.pvp_prestige_gain,"Prestige gain",t)+f(e.pvp_rating_change,"PvP change",t);return o+(o&&r.length?"<br>":"")+(r.length?`${r.join("<br>")}`:"")}function He([e,t,r]){let[o,i]=Be(t);if(i){let m=qe(r.r.combat,o);e.cells[2].firstChild.remove(),se(e.cells[2],i),b(e.cells[2],F({innerHTML:m}))}}function Me(e){return e.map(t=>[t,s(t)]).filter(Ee).map(([t,r])=>[t,r,r.cells[2].innerHTML]).map(Ie)}var Ve=([,,e])=>e&&e.s;async function G(e){let t=n('a[href*="&combat_id="]',e);if(t.length===0)return;(await Promise.all(Me(t))).filter(Ve).forEach(He)}function D(e){n('a[href*="=trade&"]',e).filter(t=>!c(t.href,"subcmd")).forEach(t=>P("Trade",t)),n('a[href*="=createsecure&"]',e).forEach(t=>P("ST",t))}function Ue(e,t){let[,,r]=e.rows[0].cells;r&&!t&&u(r,'&nbsp;&nbsp;<span class="fshWhite">(Guild mates show up in <span class="fshGreen">green</span>)</span>')}async function Ye(e){let[,t]=await ce(e);return[`.fshPlayerColoring tr:nth-of-type(${s(e).rowIndex+1}) td:nth-of-type(3) > a:first-of-type`,t]}function je(e,[t,r]){return e[r]?e[r].push(t):e[r]=[t],e}var Ne={guild:"green",ally:"blue",enemy:"red"};function We([e,t]){return`${t.join(", ")} { color: ${Ne[e]}; }`}var ze=([,e])=>e;function Fe(e){return h(e.filter(ze).reduce(je,{})).map(We)}function Ke(e,t,r){let o=Fe(t);o.length&&(Ue(e,r),e.classList.add("fshPlayerColoring"),b(document.body,ae(o.join(`
`))))}async function q(e,t){let r=n(d,e);if(!r.length)return;let o=await Promise.all(r.map(Ye));Ke(e,o,t)}var H=0,Oe=/You ranked \w{3} in your PvP Band! You have gained \d x PvP Ladder Token/;function Qe(e){return Oe.test(p(e.cells[2]))}function Xe(e){let t=w(a(e.cells[1]));t>H&&(J(C,t),H=t)}function M(e){H=g(C),n(N,e).map(s).filter(Qe).forEach(Xe)}var Je=[["addIgnoreLink",S],["colorPlayerNames",q],["addAttackLinkToLog",x],["changeButtonLabels",D],["trackLadderReset",M],["showPvPSummaryInLog",G]];function Ze(e,t,[r,o]){g(r)&&o(e,t)}function et(e,t){Je.forEach(y(Ze,e,t))}function tt(e){if(Z())return;let t=le();t&&et(t,e)}export{tt as a};
//# sourceMappingURL=chunk-Z4BWJKFD.js.map
