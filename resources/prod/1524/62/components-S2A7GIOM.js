import{a as We,b as Fe,c as Ge}from"./chunk-KLFVZEZU.js";import{a as se}from"./chunk-SILMAFY7.js";import"./chunk-ATSX26LL.js";import{a as H}from"./chunk-G3M5GNE3.js";import"./chunk-D4VE7LUA.js";import"./chunk-GFYMJ5JH.js";import{a as Ue}from"./chunk-PIMHQFPI.js";import{a as J}from"./chunk-AVDEFDT6.js";import{A as le,C as ee,G as ie,H as ce,J as P,K as R,L as h,M as v,O as Ve,P as He,Q as M,R as Q,S as B,T as Y,U as Z,a as S,d as O,e as fe,g as Pe,h as ne,m as X,o as u,p as y,q as C,r as Re,s as g,t as q,u as I,v as re,y as E}from"./chunk-5AZ2HWTX.js";import"./chunk-YMRJ7NHP.js";import{a as Ne}from"./chunk-PFGCDC22.js";import{a as Qe}from"./chunk-EO2MU5IH.js";import{a as je}from"./chunk-XTTJ6RCJ.js";import{a as Le}from"./chunk-OPOPSGUH.js";import{a as K}from"./chunk-LX6BJAAE.js";import{a as Me}from"./chunk-HUVFJU6B.js";import"./chunk-L3KWCNKY.js";import{a as Be}from"./chunk-WPPV5C7D.js";import{a as N}from"./chunk-EHOBQCEV.js";import{a as z}from"./chunk-VML6VTTW.js";import"./chunk-73BUZD3L.js";import{a as Ae}from"./chunk-T3KU5OD5.js";import"./chunk-U6MH67WD.js";import"./chunk-67AICILL.js";import{a as Ie}from"./chunk-V3AM6ELX.js";import{a as V}from"./chunk-TTIL6Q2Q.js";import"./chunk-CYTNSAKG.js";import{a as G}from"./chunk-FEXWWVND.js";import{a as W}from"./chunk-7XTGUVW5.js";import{a as F}from"./chunk-CF4P6XS2.js";import"./chunk-G3R5NAPB.js";import{a as oe}from"./chunk-CQ3PZTYF.js";import"./chunk-C5OE7PQU.js";import"./chunk-RY5JB5JV.js";import"./chunk-SWDYJ63E.js";import"./chunk-3WYOJJSD.js";import{a as we}from"./chunk-FM7OJ7NO.js";import"./chunk-HA7HK2NF.js";import"./chunk-U546IVLZ.js";import{a as Ee}from"./chunk-DXI2WUUD.js";import{a as j}from"./chunk-JQPK3YVC.js";import"./chunk-WHLURLGI.js";import"./chunk-M6FQTS4T.js";import{a as xe}from"./chunk-2URZ55LX.js";import"./chunk-FTOV4GKD.js";import"./chunk-NY6FBFCL.js";import"./chunk-UWALNOSV.js";import{a as qe}from"./chunk-27JTUOQX.js";import"./chunk-POXCGSYQ.js";import{b as Se,i as Te}from"./chunk-M72CYKCS.js";import"./chunk-ZP7KCDX3.js";var L=We(new Map),ze=Fe(L,t=>[...t].reduce((e,[,o])=>e+(o.get("del")?.length??0),0));function at(t){let e;return{c(){e=g("tr"),e.innerHTML='<td class="compDel svelte-1qoer4b" colspan="3">Deleted</td>'},m(o,n){y(o,e,n)},p:S,i:S,o:S,d(o){o&&C(e)}}}function ft(t){let e,o,n,r,l,s,i,$=t[0].get("del").length+"",f,a,m,k,w,p,d=[pt,mt],_=[];function T(c,x){return(m==null||x&1)&&(m=!!c[0].get("delPending")),m?0:1}return k=T(t,-1),w=_[k]=d[k](t),{c(){e=g("tr"),o=g("td"),n=g("img"),s=I(),i=g("td"),f=q($),a=I(),w.c(),fe(n.src,r=t[1](t[0]))||E(n,"src",r),E(n,"class","tip-dynamic"),E(n,"data-tipped",l=t[2](t[0])),E(n,"alt","component")},m(c,x){y(c,e,x),u(e,o),u(o,n),u(e,s),u(e,i),u(i,f),u(e,a),_[k].m(e,null),p=!0},p(c,x){(!p||x&1&&!fe(n.src,r=c[1](c[0])))&&E(n,"src",r),(!p||x&1&&l!==(l=c[2](c[0])))&&E(n,"data-tipped",l),(!p||x&1)&&$!==($=c[0].get("del").length+"")&&le(f,$);let b=k;k=T(c,x),k===b?_[k].p(c,x):(P(),v(_[b],1,1,()=>{_[b]=null}),R(),w=_[k],w?w.p(c,x):(w=_[k]=d[k](c),w.c()),h(w,1),w.m(e,null))},i(c){p||(h(w),p=!0)},o(c){v(w),p=!1},d(c){c&&C(e),_[k].d()}}}function mt(t){let e,o,n;return o=new H({props:{$$slots:{default:[ut]},$$scope:{ctx:t}}}),o.$on("click",X(t[3])),{c(){e=g("td"),M(o.$$.fragment)},m(r,l){y(r,e,l),Q(o,e,null),n=!0},p(r,l){let s={};l&256&&(s.$$scope={dirty:l,ctx:r}),o.$set(s)},i(r){n||(h(o.$$.fragment,r),n=!0)},o(r){v(o.$$.fragment,r),n=!1},d(r){r&&C(e),B(o)}}}function pt(t){let e;return{c(){e=g("td"),e.innerHTML='<span class="fshSpinner fshSpinner12"></span>',E(e,"class","compSumSpin")},m(o,n){y(o,e,n)},p:S,i:S,o:S,d(o){o&&C(e)}}}function ut(t){let e;return{c(){e=q("Del")},m(o,n){y(o,e,n)},d(o){o&&C(e)}}}function dt(t){let e,o,n,r,l,s=[ft,at],i=[];function $(f,a){return(e==null||a&1)&&(e=!!f[0].get("del").length),e?0:1}return o=$(t,-1),n=i[o]=s[o](t),{c(){n.c(),r=re()},m(f,a){i[o].m(f,a),y(f,r,a),l=!0},p(f,[a]){let m=o;o=$(f,a),o===m?i[o].p(f,a):(P(),v(i[m],1,1,()=>{i[m]=null}),R(),n=i[o],n?n.p(f,a):(n=i[o]=s[o](f),n.c()),h(n,1),n.m(r.parentNode,r))},i(f){l||(h(n),l=!0)},o(f){v(n),l=!1},d(f){i[o].d(f),f&&C(r)}}}function _t(t,e,o){let n;ne(t,L,m=>o(5,n=m));let{itemId:r}=e,l=ie(),s=Be(),i=m=>`${Se}items/${m.get("b")}.gif`,$=m=>`fetchitem.php?item_id=${m.get("b")}&inv_id=${m.get("a")}&t=2&p=${s}&vcode=${m.get("v")}`,f;function a(){N("components","delType"),l("delType",r)}return t.$$set=m=>{"itemId"in m&&o(4,r=m.itemId)},t.$$.update=()=>{if(t.$$.dirty&48){e:o(0,f=n.get(r))}},[f,i,$,a,r,n]}var Ke=class extends Z{constructor(e){super();Y(this,e,_t,dt,O,{itemId:4})}},Oe=Ke;var bt=/\?item_id=(\d+)&inv_id=(\d+)&.*&vcode=([0-9a-f]+)/;function gt(t){let e=t.children[0].dataset.tipped.match(bt);return{a:Number(e[2]),b:Number(e[1]),v:e[3]}}var ht=t=>V('a[href*="=destroycomponent&"]',t).map(gt);async function me(){let t=await F({cmd:"profile"}),e=W(t),o=V('a[href*="profile&component_page="]',e);return{r:(await G([t,...o.slice(1).map(l=>oe(l.href))])).map(W).flatMap(ht),s:!0}}function pe(){return K({subcmd:"loadcomponents"})}function ue(){return z(pe,me)}function de(){return K({subcmd:"limits"})}var kt=t=>t[t.length-1].href,Xe=t=>V('td[background*="1x1mini"]',t).length;async function $t(t,e){if(e.length>1){let o=W(await oe(kt(e)));return(e.length-1)*50+Xe(o)}return Xe(t)}async function _e(){let t=W(await F({cmd:"profile"})),e=V('a[href*="=profile&component_page="]',t);return{r:{max_components:await $t(t,e)},s:!0}}function be(){return z(de,_e)}async function ae(t){let e=await t();if(!e?.s)throw new Error(e?.e?.message??"Unknown Error");return e}function ge(t){return new Map(Ee(t))}function Ye(t){t[4]=t[6][0],t[5]=t[6][1].r}function Ze(t,e,o){let n=t.slice();return n[7]=e[o],n}function vt(t){let e,o=t[10].message+"",n;return{c(){e=g("p"),n=q(o),ee(e,"color","red")},m(r,l){y(r,e,l),u(e,n)},p:S,i:S,o:S,d(r){r&&C(e)}}}function yt(t){Ye(t);let e,o,n,r,l,s,i,$,f,a,m,k,w,p=t[5].max_components+"",d,_,T=t[4],c=[];for(let b=0;b<T.length;b+=1)c[b]=Je(Ze(t,T,b));let x=b=>v(c[b],1,1,()=>{c[b]=null});return{c(){e=g("div"),o=g("table"),n=g("thead"),n.innerHTML='<tr><th colspan="3">Component Summary</th></tr>',r=I(),l=g("tbody");for(let b=0;b<c.length;b+=1)c[b].c();s=I(),i=g("tfoot"),$=g("tr"),f=g("td"),f.textContent="Total:",a=I(),m=g("td"),k=q(t[0]),w=q(" / "),d=q(p),E(m,"colspan","2"),E(o,"class","fshTblCenter")},m(b,A){y(b,e,A),u(e,o),u(o,n),u(o,r),u(o,l);for(let D=0;D<c.length;D+=1)c[D].m(l,null);u(o,s),u(o,i),u(i,$),u($,f),u($,a),u($,m),u(m,k),u(m,w),u(m,d),_=!0},p(b,A){if(Ye(b),A&2){T=b[4];let D;for(D=0;D<T.length;D+=1){let De=Ze(b,T,D);c[D]?(c[D].p(De,A),h(c[D],1)):(c[D]=Je(De),c[D].c(),h(c[D],1),c[D].m(l,null))}for(P(),D=T.length;D<c.length;D+=1)x(D);R()}(!_||A&1)&&le(k,b[0])},i(b){if(!_){for(let A=0;A<T.length;A+=1)h(c[A]);_=!0}},o(b){c=c.filter(Boolean);for(let A=0;A<c.length;A+=1)v(c[A]);_=!1},d(b){b&&C(e),Re(c,b)}}}function Je(t){let e,o;return e=new Oe({props:{itemId:t[7]}}),e.$on("delType",t[2]),{c(){M(e.$$.fragment)},m(n,r){Q(e,n,r),o=!0},p:S,i(n){o||(h(e.$$.fragment,n),o=!0)},o(n){v(e.$$.fragment,n),o=!1},d(n){B(e,n)}}}function Ct(t){let e;return{c(){e=g("div"),e.innerHTML='<span class="fshSpinner fshSpinner12"></span>',E(e,"class","compSumSpin")},m(o,n){y(o,e,n)},p:S,i:S,o:S,d(o){o&&C(e)}}}function Dt(t){let e,o,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:Ct,then:yt,catch:vt,value:6,error:10,blocks:[,,,]};return Ve(o=G([t[1](),ae(be)]),r),{c(){e=re(),r.block.c()},m(l,s){y(l,e,s),r.block.m(l,r.anchor=s),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(l,[s]){t=l,He(r,t,s)},i(l){n||(h(r.block),n=!0)},o(l){for(let s=0;s<3;s+=1){let i=r.blocks[s];v(i)}n=!1},d(l){l&&C(e),r.block.d(l),r.token=null,r=null}}}function wt(t,e,o){let n;ne(t,ze,i=>o(0,n=i));function r(i){let $=new Map(se(i,"b").map(f=>[f.b,ge({...f,del:i.filter(({b:a})=>a===f.b).map(({a})=>a),delPending:!1})]));return L.set($),[...$.keys()]}async function l(){let i=await ae(ue);return r(i.r)}function s(i){ce.call(this,t,i)}return[n,l,s]}var et=class extends Z{constructor(e){super();Y(this,e,wt,Dt,O,{})}},tt=et;function ot(t){let e,o,n;return o=new H({props:{$$slots:{default:[St]},$$scope:{ctx:t}}}),o.$on("click",X(t[2])),{c(){e=g("div"),M(o.$$.fragment)},m(r,l){y(r,e,l),Q(o,e,null),n=!0},p(r,l){let s={};l&256&&(s.$$scope={dirty:l,ctx:r}),o.$set(s)},i(r){n||(h(o.$$.fragment,r),n=!0)},o(r){v(o.$$.fragment,r),n=!1},d(r){r&&C(e),B(o)}}}function St(t){let e;return{c(){e=q("Enable Quick Del")},m(o,n){y(o,e,n)},d(o){o&&C(e)}}}function Tt(t){let e,o;return e=new tt({}),e.$on("delType",t[6]),{c(){M(e.$$.fragment)},m(n,r){Q(e,n,r),o=!0},p:S,i(n){o||(h(e.$$.fragment,n),o=!0)},o(n){v(e.$$.fragment,n),o=!1},d(n){B(e,n)}}}function Et(t){let e,o,n;return o=new H({props:{$$slots:{default:[At]},$$scope:{ctx:t}}}),o.$on("click",X(t[3])),{c(){e=g("div"),M(o.$$.fragment)},m(r,l){y(r,e,l),Q(o,e,null),n=!0},p(r,l){let s={};l&256&&(s.$$scope={dirty:l,ctx:r}),o.$set(s)},i(r){n||(h(o.$$.fragment,r),n=!0)},o(r){v(o.$$.fragment,r),n=!1},d(r){r&&C(e),B(o)}}}function At(t){let e;return{c(){e=q("Count Components")},m(o,n){y(o,e,n)},d(o){o&&C(e)}}}function qt(t){let e;return{c(){e=q("Quick Extract")},m(o,n){y(o,e,n)},d(o){o&&C(e)}}}function nt(t){let e,o,n,r;return o=new H({props:{$$slots:{default:[xt]},$$scope:{ctx:t}}}),o.$on("click",X(t[5])),{c(){e=g("div"),n=g("div"),M(o.$$.fragment),ee(n,"display","contents"),ee(n,"--button-color","red")},m(l,s){y(l,e,s),u(e,n),Q(o,n,null),r=!0},p(l,s){let i={};s&256&&(i.$$scope={dirty:s,ctx:l}),o.$set(i)},i(l){r||(h(o.$$.fragment,l),r=!0)},o(l){v(o.$$.fragment,l),r=!1},d(l){l&&C(e),B(o)}}}function xt(t){let e;return{c(){e=q("Delete All Visible")},m(o,n){y(o,e,n)},d(o){o&&C(e)}}}function It(t){let e,o,n,r,l,s,i,$,f,a=!t[0]&&ot(t),m=[Et,Tt],k=[];function w(d,_){return d[1]?1:0}n=w(t,-1),r=k[n]=m[n](t),i=new H({props:{$$slots:{default:[qt]},$$scope:{ctx:t}}}),i.$on("click",t[4]);let p=t[0]&&nt(t);return{c(){e=g("div"),a&&a.c(),o=I(),r.c(),l=I(),s=g("div"),M(i.$$.fragment),$=I(),p&&p.c(),E(e,"class","fshCenter")},m(d,_){y(d,e,_),a&&a.m(e,null),u(e,o),k[n].m(e,null),u(e,l),u(e,s),Q(i,s,null),u(e,$),p&&p.m(e,null),f=!0},p(d,[_]){d[0]?a&&(P(),v(a,1,1,()=>{a=null}),R()):a?(a.p(d,_),_&1&&h(a,1)):(a=ot(d),a.c(),h(a,1),a.m(e,o));let T=n;n=w(d,_),n===T?k[n].p(d,_):(P(),v(k[T],1,1,()=>{k[T]=null}),R(),r=k[n],r?r.p(d,_):(r=k[n]=m[n](d),r.c()),h(r,1),r.m(e,l));let c={};_&256&&(c.$$scope={dirty:_,ctx:d}),i.$set(c),d[0]?p?(p.p(d,_),_&1&&h(p,1)):(p=nt(d),p.c(),h(p,1),p.m(e,null)):p&&(P(),v(p,1,1,()=>{p=null}),R())},i(d){f||(h(a),h(r),h(i.$$.fragment,d),h(p),f=!0)},o(d){v(a),v(r),v(i.$$.fragment,d),v(p),f=!1},d(d){d&&C(e),a&&a.d(),k[n].d(),B(i),p&&p.d()}}}function Mt(t,e,o){let n,r,l=ie();function s(){N("components","enableQuickDel"),o(0,n=!0),l("enableQuickDel")}function i(){N("components","countComponents"),o(1,r=!0)}function $(){N("components","insertQuickExtract"),Le(Qe)}function f(){N("components","deleteAllVisible"),l("deleteAllVisible")}function a(m){ce.call(this,t,m)}return[n,r,s,i,$,f,a]}var rt=class extends Z{constructor(e){super();Y(this,e,Mt,It,O,{})}},lt=rt;function he(t){return K({subcmd:"destroycomponent",removeIndex:t})}function Qt(t,e){let o=Me(e),n=1;return o==="Component destroyed."&&(n=0),{r:n,m:o,c:t}}function Bt(t){return F({cmd:"profile",subcmd:"destroycomponent",component_id:t}).then(j(Qt,t))}function Lt(t){let e=t.filter(n=>n.r===0),o=t.filter(n=>n.r===1);return e.length>0?{r:e.map(n=>n.c),s:!0}:o.length>0?{e:{message:o[0].m},s:!1}:{e:{message:t[0].m},s:!1}}function ke(t){return Ne(t.map(Bt),Lt)}function $e(t){return z(he,ke,t)}function jt(t,e){if(!e)return;let o=e.get("del").filter(n=>!t.includes(n));e.set("del",o)}function Nt(t,e){L.update(o=>(jt(e,o.get(t)),o))}function Pt(t,e,o){L.update(n=>(n.get(t)?.set(e,o),n))}function Rt(t){if(!t)return;let e=t.children[0];return e.replaceWith(Ae({className:"compSumSpin",innerHTML:'<span class="fshSpinner fshSpinner12"></span>'})),e}function it(t,e){Pt(e,"delPending",t)}function Vt(t){t.forEach(([e,o])=>{o&&e.children[0].replaceWith(o)})}var Ht=t=>t.forEach(([e])=>e?.children[0]?.remove()),Ut=t=>t.map(([e])=>[e,Rt(e)]),Wt=([,t])=>t,ct=t=>se(t.map(Wt)),st=([,,t])=>t,Ft=t=>ct(t).map(e=>[e,t.filter(([,o])=>o===e).map(st)]),Gt=t=>Nt(...t);async function zt(t){let e=Ut(t),o=await $e(t.map(st));o?.s?(Ft(t).forEach(Gt),Ht(e)):(Ge(o?.e?.message??"Unknown Error"),Vt(e))}async function U(t){let e=ct(t);e.forEach(j(it,!0)),await G(Ue(30,t).map(zt)),e.forEach(j(it,!1))}var Kt=t=>Pe(L).get(t.detail).get("del"),Ot=(t,e)=>J(Ie(`img[data-tipped*="&inv_id=${e}&"]`,t));async function ve(t,e){U(Kt(e).map(o=>[Ot(t,o),e.detail,o]))}function te(t){let e=t.dataset.tipped.match(Te);return[Number(e[1]),Number(e[2])]}var Xt=t=>[J(t),...te(t)];function ye(t){U(V("img",t).map(Xt))}function Yt(t){t.target.tagName==="IMG"&&(t.preventDefault(),N("components","quickDel"),je(t.target),U([[J(t.target),...te(t.target)]]))}function Ce(t){t.classList.add("fshQuickDel"),xe(t,Yt)}function Zt(){let t=we("profileRightColumn"),e=qe("inventory-table",t);if(e.length===2)return e[1]}function Jt(){let t=Zt();if(!t)return;let e=new lt({target:t.parentNode});e.$on("enableQuickDel",j(Ce,t)),e.$on("delType",j(ve,t)),e.$on("deleteAllVisible",j(ye,t))}export{Jt as default};
//# sourceMappingURL=components-S2A7GIOM.js.map
